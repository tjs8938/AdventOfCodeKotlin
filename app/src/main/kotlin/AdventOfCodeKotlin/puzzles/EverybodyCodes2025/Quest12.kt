package AdventOfCodeKotlin.puzzles.EverybodyCodes2025

import AdventOfCodeKotlin.util.Graph.Companion.buildGraph
import AdventOfCodeKotlin.util.Node

class Quest12 {
    companion object {
        fun part1() {
            val input = """
                94251725667782383839
                99880087051662431199
                49941347484655564992
                22998770454651139936
                13199517175123499255
                85759955682880991710
                31251993583749926605
                68437399501599002258
                48810409988996563773
                82867240999981283660
                26248076199761774187
                52047707999907247225
                26017219964995287113
                17272699268899174024
                47225990512029933253
                78729954253718995810
                00599578537540699576
                25993646423452349937
                39968350183250651997
                99440610237855014199
            """.trimIndent().lines().map { it.trim().toList().map { c -> c.toString().toInt() } }

            val graph = buildGraph(input, ::Node)
            val blown = mutableSetOf(graph[0 to 0]!!)
            var toProcess = mutableSetOf(graph[0 to 0]!!)
            while (toProcess.isNotEmpty()) {
                toProcess = toProcess.flatMap { node ->
                    node.getNeighborNodes().filter { neighbor ->
                        neighbor.value <= node.value && neighbor !in blown
                    }
                }.toMutableSet()
                blown.addAll(toProcess)
            }

            println(blown.size)
        }

        fun part2() {
            val input = """
                99999999999995297378424826991495619692589471008967566688312286492595340904091285831123171478837742626817925130184617924049071160663688044815750498487452430092191080155824108127
                99999999999964539992275880312686115348185507013535591794311542696182375471995822293532746981802985723980312977621717733678398665828044603741643335618348929465348873144845049385
                99999999999995919999179399124951350908321250549435557626830390351198064542727324020874330327549222877461137802722884649238096392584002514518178867250921486049972101033851161754
                89999999999999999999999994559543031873586132192853556592712750598451466419462257554830467534769999959974694467046375913775816822402241116577632103661227316795816713055893221397
                29999999999999599999993610312822208420731956312191899484223513844524765870577140239999999511999999995781599999960773799817018691022778142061494649842017670532334726834262646726
                13199999999937699999995623309396364752468435986955965013320761526259190927322301899999999999999999999999999999997279869997814669670203609576039491326597213603987225511892340620
                79999999999924362499925338315694409859533831711559742061541431640765090599999999999999999999999999999999999999999999999999806129670716667396218874640939236269501025990712699562
                54499999958012948697108245076076915149357241813472125650024827271839416559999999999999999999999999999999999999999999999999975857995940176228286195379094204026499060756457778653
                41999999923414908925388205102275510182135636461191141376247134774399996999999999999999999999503799994930299999999999999999999497159673091312080473966621825932536125392966919989
                59999999945322820847459218178887294644553813785664146478702888999999999999999999996281099999756319999219329999949999999999999999999999436432278622819959106643398670245121433779
                99999998908670775355398272672700796652655524135870438355372107556999999999999189999911169529298924727003190969620871999999999999999999590232485205523863016741791148468887780462
                99999992159996299931778116190449743061743734612917164927637111747999999999833935955874538810187473732821480655015675999992999999999999981459997482499718667899298014027231333963
                99999999999999999558282845396517765649505583565074432777239999999999994999938442639159018662669599324107026403799508599979192499999999999975243633317955076228118489357724186164
                99999999999999994763823335255947438270653595106355741843989999999999949701084318651114448518399074527562007748388653689593418499999999999999999972772436812311523604125711747569
                99999998819999996008826932935521320078655761602092582032439999999999991864100542100819415308492325324898083827591375468441562999999999999999999955712344178319044968799293069852
                99999994114166160881681276998585517058243913479841509806999999999995385430326273800546102202924139940589606019677178166684687549877872999999999924055623304175452154531232970429
                99999995038406377936384537619962047865958595663023372999999999999671318095654637127325059326720435671122067770703104592637408003890822799999999962529699774531553812105492499222
                99999923202217954692036454083331405859452944457511999999999999997419469140439213529558770100493389254700342785675621666437121733775220699999999993997758955531531383450113185915
                99999949136072225994578989377338232031991182468863143999999999648284680624779996323840755627375325579302612670711122962964210133999779999999999999999999989028050104342080086893
                99999925459572681415638684435452851011672250378117011999994283086601298507246272142504901921627857477951818065873353450841654976518860999581999999999999999413229288539183445934
                99999979994999915687576324932447938911447136493470999999987129436536044060488811788925899914996740903711183808850604698995229497904744569673779999999999993033979171542177153699
                99999949999993391035860800553349176455968074114244999999999151702687384116952233957999999999999999998244710820628937516250738287166226841864824999999999951123609662019337510768
                99999999999999829086339775268878175503095150804742699999326390451068232484881629999999999999999999999284732764292890379092959633768085964942743999999999697185417756704881726474
                99999999999999304079287519487518979476072009325772799996784876305983135564539999999891673599849899999999901798657403962757286248386048912615999999999999852817499955560937314032
                99999913899996854835053450192407060610105632517889999999962302030855608179999988511495913489604673939999999942381777187268209037015726300791999999999999999954222947527320320458
                99999991183527896935115055418907721910966877749899999999954563806574616709999178278536888550362385793999999992319333541170921373770277528105531981739999999999999834775486251704
                99999910114956937996564252964942270676345755750999999999120409540982282999986334869959786155381389975359299999792843830047126817123156060826136933932999999999999963411961004175
                99999997588588864178015883266242499583543809414609999999232696758147355999950687797888884120732632981614399899999363559813729330969380144485765471537699999999999906131832726598
                99999965303747996426054068136009042482041699785194999999971975402777339999626692888999999999254888420505474749999521567009662559387820022650949533330599999999999543411723330359
                99999916992929994390796684779540130840843137570599999999296964130539619992906068888860049199992613264638485999999999299936087906428992164599911892699999999999996676418177407336
                99999913999999408186774057657248042013612432192939999999623732788312449991683588888888878989999610932746683098799999194588357018829640829661615425699999999999939173772174898711
                99999999999999996306177503329865798437201830099498729999933882613158049998118088888888884491199997269042553946799999196213930650481873717088552997875492899999999999435963279993
                99999999999999988755346461255965147905164848301123899999994264122503593999637148888888888090229993824983595916999999007394935812438070331127480946718947639999991299998959286139
                99999999299995311494224030331602519103336381920437999999344446205164994499933732888888888617219993591450701341457999895768392377610170041222235744547506139999999899999941818330
                99999999974979374079980399251478985624183475760303999999999119984702589899998502403888886212869999964683491039976999995660937964942052031353883026297137601999999999999996579078
                99999999920607969612204308187106662984223714449683179739999949226509471990999999999998858118749994529051169479699999990282674603190493373487906610196397206699999999999994047232
                99999999988355680297192788353271088877887991114228943899999905769810488594057688888426326638599997521134863982499999919525428956431061936857065866403038999999999999999941316096
                49999999995166926998574121874440860051847775648944889899999999907548162810297483543354563811999944948345537729944399991913488791308896367739448302552747999999999999999284323185
                79999999995299919997849772551022290267838769555370721562219999946130797666422882129135455499999952731458360499245999999406994727015349177336240813276111499999999999912376375132
                60749999999959999999681423865592280244833928184823663505129999999997820022598018639315045999999785814900969702999999999128398129233798995593428549474677399418999999999382281721
                79289999999999999999862713360870260740866822500896989169749999999996599992607259715792999999929030692648134392938999943135533244964535693701240998993472286080039999999998926897
                92561999999999999992730759630803580501308783104163931341226880499999999424999999599999999992468965510775329299905999960629684643965855532741492714603859127484681999999999933400
                35099999999999784734354411325155729943485101410559352051355518399999999999999999999999961726114400366908740504889999999441725373327839059214731022611499743526505699999999999824
                51999999999999997272246322120664134359088369602049236863780246771634899989999999999549613694823939005057994249999999999732162238366867089278312072708797117154831599999999999993
                31999999999999992418462449101956813095020154008155126894153349587063220611299223112729202852586599454263725121999999997427781264234216882000123868599467136719296999999999999995
                72699999999999999395364799175279283488096108176326732698421616191254250422550011192429039828768611439112411978999999831087925625237023482756761211237634432999999999999999999957
                97981969999999999998999999999238799115795710049914999710332201482098503462546464709640281303288086365934279999999999336068473246500819692036686835170936813999999999999999999896
                16487791799999999999499999999744059274542458802022515488306185916303311054718366801840620352728451432115499999999999421122083377917697958844855810100807171799999999999994994145
                22109999415989999999999999997739273301055869673156054232735895521543438243280677365734952975205289335924799999999999145669069236250890871210507140461105379997239999999976575368
                71201499124939999999999945120986476754809267111882436526958064213626010200018794426386252777840338478215199999999997176568178728813084257186580066551770839430173999999977643467
                10143916182805999999999999936327834932048204894900963571353929225910403986688774174581406342687097029999999999953507346744119772407698224328652039753872767040171999999626999114
                56273896361989999999999999758869424998081749653370378328859576357728194116318856558510863495187983999999999999934807839381169168418017614322295819816969132998744999999817891191
                49089153361139999999999999999218999999957230985613172410329018322090653331964385678349349668192299861999999999999979904894085193647705226370195435550196835715239999999654999995
                62759679185459999999999999999999999999939792315675785196357233284376461753940573504278612740748931696999999999942785185046696711840874481901580957950677557678119999999999999999
                13200724227482499999999999999999999999993252089270934123164085711183661265859661884701642099999992699999999991696021281795935093172436332632289027272818812599999999999999999999
                90909711351982633691459859999999999999999371589999943681873867827773723017072197019290779453999999999999962814786514488611058353491744154922053067574894389999999999999999999999
                73934357021318863999439391999999999999999998399999998398792617047696653532858024999899915885299999999999774106450766849834031488276621816766409225860657492999999999999999999999
                16588259156487254423576052799999999999999999999999954686399999985499549969984214039999999999999999999999896557287911431617708291227248113523748165617504172999999999999999999991
                91872397775392043133273111299999999983999999999999994192433899992333035899999155599999999999999999999993053829914145197985480027291973030331391743151534799978199999999999994087
                52083270922200616439075032699999999993749999999999999999999999999518199999999999999999999999999923915221160379171937684285820499222559747309729752997372891107365999999998579631
                77394398561217876399776629019999999699977199999999999999999999999999999999999999999999999999992353547911283587122853052076709995137574229374187381819677339430722809999999978725
                97286779583274827339999953741834999876271999999999999999999999999999999999999999999949999999999997170846175805963848416919521365828898473075882762929351283927126591899999999169
                12153932538361212297013205772714499990701799999999993589999999999999999999999999999956729999997163124371159338891250239350114377732219391938930638192832238324054045799999999934
                77014403686192120625144917455703029578434779999999989950189999999999987199999999994241570469638076196201712045094633314082863444619359798626081719985921724446587005648999999974
                50857342117306014851883906202591514713174031999995922075749999999998987872999999999962120139396300466961196404838284461607496330920636285541803225635174109661031899998999999992
                69924556714276868026407027240947693796692378367547993227810999999942700324244989319962594180273271207481612282611286343436610433530773732851965813478879999999185299999999999998
                75076244012301527052987170474268393656666153940551999752277561442899409546177038569768723296963900842488844045816431539478680609755795110210737492076799999999976799999999999999
                84342010142853671841342529835806196177368867030405303377131776656337752766429601266134963574908765520158497636482994348653389715437299606776234369343449999999299999999999999999
                19390652567996391733346117659401480772432356070683140191474227389283631294850042343565777957324884136318032658579241279086439284078964909495408925331359999999999999599999999999
                68144129257389699938762944479804209513558780769576009871967815386236529137673787193814558374254257383669742050556228549908296967949608864268348495799994159999996968999999999999
                39355858919557711475482931277532597518077157577583691597593173584791565040487246182678698128002985417018284037852475738885018184685446818541070084994499519999877859399999999999
                64845760088389615268158512306897925961716400187700961684997879930091457091335335253834706779912781846276523340907579408620780831908375795579999409987333395749910212899999999999
            """.trimIndent().lines().map { it.trim().toList().map { c -> c.toString().toInt() } }

            val graph = buildGraph(input, ::Node)
            val blown = mutableSetOf(graph[0 to 0]!!, graph[graph.height - 1 to graph.width - 1]!!)
            var toProcess = mutableSetOf<Node<Int>>()
            toProcess.addAll(blown)
            while (toProcess.isNotEmpty()) {
                toProcess = toProcess.flatMap { node ->
                    node.getNeighborNodes().filter { neighbor ->
                        neighbor.value <= node.value && neighbor !in blown
                    }
                }.toMutableSet()
                blown.addAll(toProcess)
            }

            println(blown.size)
        }

        fun part3() {
            val input = """
                1235273242393942959461925953369332125961111634222922469375853557221324442519762484354273959488591639312264496467572599585853256496975276274672582622395865331162164885932895443161727179681347427898134757
                2263584275415812553993591238282532341111111112621267386111111111164584579647359768981338952938753711111185959753154252565663442945111111111115564487799211111111941263653576118333454783789541111111111771
                5876111111111395844261111111456977911116656111763391651112111111111675397111111523896433999346489119115115924911111118167862754111156411563741727837611116534811171816111111287111111539577111179835115653
                6411111111111119122221114422156196111152335888519534315911131563511177177121111128562918674232561132758155267871534414161518611187894484155524449115116362539741141611113968423526411147828116684161278196
                9911158554489911189382111765966747871162267621717762297559118344971188756121892113952621339741116118867279582513215819653457511136181334811115657981329819946981161117755934745711116833356411929219134351
                6411667898118581119921541114782441933111449615395965278596821154461171987111919384224912377128397113654981598182765119752335815713511111982642163111825369485711574118282824979497624832551711112395532942
                4411132194511116151398193199712866947514257865887675286149317171521176485511148518765114745111114911878356918122892518918181911111111615811116745419331111114113871421111111422911622663365311531469128961
                6761111111111111144911289765826749178798245748966111111111934364511671216411117357891162127186393827117381814268685311826431241111331111117111897915119212691115949149716647441169669878615111122847999746
                1331111111342571712131141221111111153595499565111111111111118946913191237471211293111184521183147457118355177111183421426164299163914591137612754317571959665297673517346121111118816214284111961118476121
                9718799757799743269577718911222222114254863911111152241164113365481951111111111111116743792142863341575866971122182196111587882661173111219228411561864111395851667324291119462221816531711441763441233744
                6568631914991871113922172112111111111137926111117845773538816363751111112219647211334131365811512397378849111222142822458228482111153111642156212218411171111879132927111147785132728611167394574566176913
                9264388489425111111113678812169945224174831112315428992161744923911111312217356335958111378215568949781711111232117369829977911122119214319137581883414245711759218411229398351578752111319365972777122977
                7981235133832114831441151111118439714168129111491797611111461221111111712214281264811121148443659457111111681232126968178911112222117118715548196316818983876186919191918651775332311319552777339119116789
                9253111111639411727947353472111168875199357611111111119961137737113914412111353941112221491866711111111717911222111111111111112332128111995461153858911179293623119479111189218275836516954116542221111784
                1821111111136636481814863866161111192452356584561169334658141491142396111192334111222321644411111117196624112111111111111149512322154118167157962821626111835149115332996768649124367116569111414718195574
                5541154112116745933543552383118768715926527367652391111111989736162344111172211122233321231111245443998271111121687649486321112221146411118979743446528681111111179524763187416576974117571911768881487256
                1611164228811816657979221119465624141761118321387111111111111325142911113771112223333221111221111111181111111184511111489111222211998671678768211151632681823214653571848291118143344114664391116111789479
                6511189135645124565592111211119427711111111172911111447961121975144511331311222322222211111111111122111221624369111183711112232117649773771111112122991993932489456887931113141111723421113468111145326481
                2411419912122211379751121111114423112111112115431213548167111853354166592112222221111117687177188111111121111164437822111112332124919431331111222125811111111188287555117728822511311711644763161484875229
                8911186337813119216243121125111769121114911219881111692871611158174885111122211111669268478496395881129111112111113156497712222111111111111122222142511429511118545161239497871118746918653879716941524381
                9591143951113179226559111336413617121592491215594111173551256483215311122211117234848691536894195167928977211112111164111111111111112211111223221181511318917511112297326138641212592726664396683271489777
                4531117111389119873217711192327151111128991111769331111651957572681112221118597895919111111111111111135312331811122111111111775851811111791232211894251973641461848948115163369243296985237947111111113665
                1218111117314152343889938111417425612158931129636351413111228419911222111651188421111137927121711611111119785433112222184351669542535832911232111169811666879561896233963931111192939344128411151575631213
                7192241823126811111118167977111264211111363892299936647964886681112221188837388112725563978876233765913611113742211122119326861111134566112222136386234929835831725751381111111785311696636111383848831564
                2586887559765111111111124475581972889211158932611111111177265211222211293441631468365218525111169226542616118988672112211148623281174811122211117642729723781311237131111949991373183547862111594411111427
                8135669781431111315611116218235592465982136649111111111119132712222119429132619714469831111116315599811111145861375111221115994348111112221117597247443484974112165461183599961738852431762511965422167766
                3872773153551116244462152617111111111225568541121738931219738112221184587312233114182111221132259111125845661552845761122211418547111222111585937351118654897397886797112811119873311111921578267342958187
                2866321673868111258561385731111191111111122684121944181115281122211431133927919612491122221475496172131454261111119133112221422565481111142872886311311198921947931158111111475295133276116191758191142962
                9338919537945811112668466115118449687111124587121134611129731223218536111477817923811223321174876692451954911179211436311221117327529115714184977351613711668255183929544243768211883311311373647636635416
                5362164239191991911113574811111151242731117519112126911187511233217356111151446379812233322114633438311281811657114419721222211113116411274966881511383531122888682111111357362113163198117627232111111151
                3253177177572351393271773476511116726461964738611113311764212233219566693824813735812233332211111111111239811748611677631123222111111111118727497233163293185286111137151113984712631791145933631118271143
                9691167381116969981358112891746611111197179149941111711762812333218639291821312314611223333222222222221165611211818591767123332222222222211131599696216556116675116943861111186637929547671532316978371132
                7221126391213933241111117613321674972432898482277869811414212333217991116522827169751122223333333222111111111799941158265123322222222211111281921138828617414578116936212511189543593733518619729971511699
                2251149361217855111119812612779413828561117491131267231445112222211111111111257197946111122222222211171112213381175111974123321111111119923416279591891898815569697171175111845796998912677866456948676555
                1341179861116391111634416714636531111111211111157195861486712211119424331611118816685668111221111119332612211499282111997123321341938252472883465946148283113369147132111181725788481111111492111162828898
                1491181611144631114576558195141111222222222222111182361852412114196468845963111139926123471111342338521112221614989111877123321139243628411111111183511273126193275786718363195111111872611111998112573522
                9586115111456153111455111969611222222111111122222111743484711163711148313896461111126826177891136111153912221164157511374123322136196115261143741111314111132992659697892425162119753121688114142145548359
                9254811117558429311111187179112222111163376111122221119511116191111798214144859711119776544412578141389511111426562111979123332111834754987186172719258244734175111111111646741166177783791117478111177456
                4425386695511921228573515971122221164578633711111122211112211111144498111315593172111111329376341455111111111989969115645123432221133969868384551211173787614111111643611126191866431781111138251178111324
                8518736818114552481918956131223211467211111166937111122222218721266693119111113519661111111111111111111115111757191199895123433322117497321592731189638525281193336825451128291998851111419454671151311171
                2422986191111511992954851811233216252169251673528715111122211333531699116862359994811751221111111111175119117355911972671123332222211537474791118465886827998113218764111244161384571942385473216168221197
                6286219961855111169577178211223213616479466139447466682111111111932419513997417785995111211988485426221691111671114361611222222111111114792912268719911197854116386511164217891184885111111785748866911286
                8597421911175811489619232571122211293811111111175734223228865737734315137788481181111121115142419731679311117461111345312232111127335564115533181111112111843311683373847617729489211112411113423376691154
                2254891311711111117165394222112221163711122222111168572497545631132599383771111111221111221664496876681641133911633642112332136329529711111111122439122221115593145276833649158259511554789111729227468988
                2623484211112114881191421756311222116666111122222111132822481588649679111111122222111767442954165652958211139916765268122332138712571111134891172686123322211154411148331111111177519226941178564468722428
                3184713449111187241111241611991112211116174111122222111111111111111111122222222332163852437821111124412391899893454811123332132416962114795211838461123333222114739948111111111118511865384737983711119676
                1712411462939454861993111231752611111111131752111112222222222222222221111111112232111111111111111216175911813587951112223432111167828181844112291511223333332211834911122767444114781119139595911115111667
                7313181162796919661996711457431881761111111639949811111111222111111111582574411222222222221111572148111128687852462122333332221341675729421164741112222222333221152911218637761119297311111331111161471192
                2787581131159179321168111143146557929933491865587927784681111178649592829229241123333222111458171611115811119273411122222222221413166992114357181122221112343322112711844692111191647127578233312276991876
                7837936119688163691111115111111111158161462134232831499561163911111111561871212123322211152556761113958111251527112211111111111162912811196956811222211212333332213411878551195385546111114756458723311876
                1714842117493511973311156351111111155356911111119654972742194452881711256346121122221118384832111873411146617211122118562463885389719123824442112222115312222223216161594911893411111111111875646337241763
                7216329111431651155354818911411951117452411111111316887387565869249119433871111222111238431411773951113737852112211119688651478848519265266811122211186412111123211595882735122111118964311167646391275681
                2811976111168158116919812115462411143939311613711455161111118535961126831111222111127693871113245113655167461122116954252111111139817145621112222111911911198123221613676812921111599513734428643711411931
                2361173119742112111461566185222712154157371564431136781112494198111321111222211165881633652214411722413257111211142791878125111577451911111222211132321111128123321719593993951115641322431634173111163853
                8748911193914116116298381375262811191339315134618326111325186711639811122221119717411186835439116291167311122113917311411112323974121111222221114351351119776123321136691411158111199678664377911111111521
                9817237711278711112797851997926111727111111648557117119659871175261112222111266935816111116291545114755111221199733191115441811111111222221111321116631115228123321841552112175361111111145476115595281133
                9722298286934241523437151741271184436111111798824661147671118937111222211194862626962212212881111749411122221965982554993111111122222221111783991215811164991123321526711122113159446349224696119216561142
                9741819796818144984721641158949623321172711136678341192111151271122221119316818294885112111366398541112222221111111111111122222222211111832383114144111135341223321221112222214711464792457645171952271121
                5117955499834563295675366765184711241626412117818978111326884311222211471734131272277121173535569811111111222222222222222222211111117514289381184731111528781233321111222333211966711111119481313281251199
                9168311123171918816845449514717544261447412113744119667214741112221115816314188834111111819546111111333751222222222211111111116912279118411113644111114587711234322222222223221454111344951267435623111781
                2917611746184175214111111111111836875528311125323115312778111222211533341135495722121112628211118939717111221111111114795741132858535239731553861111856342112234333222111123321195117254121152718984259776
                7436961182139155711229183117911152585749811289985761716414112222115846115784614461111743911111179721111111111557516642472721111111111224437173111116454511122333322211149123322153117434751672341121219218
                8761781143198111441122317294251196836997413784161211132781122221137181172347168611171723211177635111111115494185742416441111111111111113426111115285171112223322221119871123332113113517947285371692457566
                5615671145114215961121716399911285551827112881193859186511222211163811375111915115469541111976121121116193334822489111497399152656612218861117925949111222333221111657121123432165911112985639675311113143
                5291211977114219259111126751113127916175256411697794118212232112933119194118921119353611116773111111573324351234355111272864377261312113997677158291111112332211935979473123432164258583281932974818911665
                5468111873811119651572111111124812134511117111172981199112322142951148211111111329757111189561121128983461111227911162697818268869111116425862751111119412322113513141161123432129741491813744969148861961
                6725271529511149528364781255521121278311997711392821422122321128291182111445519221121111985511211298971128212485117926523979465111115527243735481119146112221155117261175123432124323191111113453196591769
                6583835897178824982126298179575311119111177711791615294123321281318742115286153925864111111112215545612996112251195617575421111111527452929434111142661122211691119691179123332121671113368341169628327751
                5752136732466612815688111694865111627161995111111199641123321145556495111751559111971113492122118797114471152711251772811111111196655218548711111868911222119542411921147123322177211863487411138856928271
                3641821219372734441252299911125611762111938922425375681223321168892286117475791117141218231122119351111671547911498153958532431156577537911111818967112221121461911151261123321118119175696511263725385471
                3511587111159324141168685811912161111171392956659455141233321752942757111838881173521216371222176911373831262218563711166291781115111111111149766511122211477179312111821223221584116343111115199464799831
                6221651191711535117111124511764593144144639113896326411234321428111111511128111167291214921122112731143731888118854191485815311111111111319288631112222114793691111111211233211753711229617292691111111158
                4641111151211111141411111112184888268821318138179859661234321628371119496111113773221119548122112319115981194418245752699571111471687413911111171122221192146711181418111232219974111162642171111148811245
                2837518456815181122834317481858299473627741181311334321233321981364117272996811149272119686112219556111815113412141111111111126226131111188185111222111737723211887291112232118356141116388811273492113587
                9315564819111774177714769285966531222447611157611284731223321869911114853133993118151111576211211153481111145714851111111968914127115237671911122221198921186311163241112322138927111485941115874141291921
                1882648641146821181472176241756181122115968115361141141123321931111176911111111118631111166951121157363411987815323933333336517847866239941112222111992416526121118911122221182971118172461143416911939614
                7113392511149511354951118921117951112913796611111146685123321172113424411948311639794571114723112112319838833115412977111111265662828153111222211178696151711111174311222211711111111129111279974484648817
                1111461638111111656515819289115411157788464576276981565123322174111249518262726124145973111256311111116955497422875111111431125251715111122221119552828654116926386112222111231111515111311372973691356163
                4717587628919581616165311371311111755311258247341439816122332113811145491244822565118396731111166122211113571232483469376863852531111122222111829561184415255791811122221199661114848411811111111172213977
                6115372937398841218552812984661892129182111176111111465112222211891137116999119469111335159211111123222211111376945967992731111111222222111156317289211964456594111222211961431186798221796851814879111175
                3173325615886763128316118272248194361113529654227181117911122221734118726155511293811172941193111122222222221111111111111111222222222111123781871742511436387831122221116633226115421561121153245511221893
                7111991111333131164711111136246331111415288748462172111616112221126172648838211185551111885121698111111122222222222222222222222111111161116798111196611824518111222111253381746111913791193563692612951148
                1278866171193919111111749138157912861119439215851111117155411222111826113896351111324141117841279738974111111111112221112111111161543278445511111829911247811122222175529797111113971111118527911167551131
                4487421972516214711236584157164571716111111111111175746175591122221136111176287111113599116932911115843994716596711111511116219538987358911111117671114421112222211125317111111961782211133194378367491194
                5133211264393171828438491342617819461826586117716513485987939112222111122111698931111111114373862841111111111465668129262711111163468911112111712966517111222221116342111474113563729462755631257953231122
                4113251121514191112427971132381177511288111812114231554514748211122222222221111322837111141724754648395231221681711111111111942552811112211192314317111122222111981811919121199464537776461221126532611997
                9562645119313717586269945111115592972984311119683111115711387632111222333322221111587147616683911111111111111853162921111266937311112211118137991111122222211199678149953622737681174821799913139331186888
                5419154911153148167636318112333975511111111115331181851111329345261112222333322221111158836369342661111111477848933319469871111112222212685311111222222221117819811965683698137916111111137154111111141771
                6587111567119263611111111359283576178296311721915414421536677315695811112234333322222111111142468273874824424511558411111111222222333211111112222232211111913764911111192995551111112253651319189257718372
                9748511871984281811612789815139819696341873968386739813746489666779795311234444333332222222111111111111111111111111112222222233333343222222222333332115613739237736699232389811111176132356845789811111326
                8321631221921995231191125914115373164639121164261761159866783914586569941233333333333333332222222222222222222222222222333333333333333333333333333332119626635538692499937616571118497951114772477119741493
                5112861143178221527111154211818763311111111111111111111111111111111111111222222222222222222222222222222222222222222222222222222222222222222222222222111111111111111111111165399111111117368854521112691765
                4953371138175848155349111115485484918145911111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111113111347572134369273678665781144393318
                6191661379117811219982741541124317192928245715539894279341259559939629837919169778252984345321257144356763861374393125751883379992583275523531835933123278794559113254933166564715571111111114751199871991
                5337112949811721196717857993822624763711191991821111111126889511112592312819191111444527644111111637792621877722628839431111121929215219111937211954945111111114185185111111151962111972695611363188845664
                8717768184311111161764611117971932746776113691117265111119911127611113985211111111111184161155851111156797429118256134111111111156353111111111114761811111192511525611121431118178113435382281214117119784
                6364282925328491163645451261113128719111181651328915681122115378531152616181228318121682411795388911848117916334115441171813927113981149336419116763211163292536318398791482113798115235164111811969533511
                8341218469564558279567814358116871116519611861821517111266111381111592962694198811111653217594426153731281893745111721136967681656421881849969175341116839634365696824841276817865111114312836517311863491
                3726152664919573661161768111166161116441111712125577123723271111166598643966111111515971171546799475786461114852511582113368719883351483317695451199114428211669895332498633518717981184235576621967286539
                5241717881717822755391193999473719581161116611139819854881673967733274696285813818439744737224992511111165871112178621191611243192283287911411415711464411141827717564375764879459557165438717556111111458
                2541273152841839852784511723119986318145232455393384931462364232363828882173562247798229489347275116277711914764518371615745562197598975421111166379581814653819311369112925119877666114377469541161611965
                6261244513183143271959651315725111111153714222564111111111193311175111111712755162125141111111783197262111712174194597757361376146581111473529911118119117777214169114687112522478137211588116657993211437
                9391567119573158514634811518353753625177111192593697129393511928114238181119888316474552861111885214227646119313493865134535291136165173438542922116971111989348868511187156255125197891515281116392811263
                6151149424981744991134114475342566782619921178623628581451113826331123331112714775113992611119372989973698499831965691937391818116356182976495111117991911132114136191111133271611987711583389123812111443
                6168111111115977967111137672795811111111149636173331111111333865224711111134736412379111111889164438343626575371111111111185118691111169873677692636375326111182146124938638131834311218829228811111181251
            """.trimIndent().lines().map { it.trim().toList().map { c -> c.toString().toInt() } }
            val graph = buildGraph(input, ::Node)

            var blownBarrels = setOf<Node<Int>>()
            fun blowMostBarrels(alreadyBlown: Set<Node<Int>>): Set<Node<Int>> {

                val results = graph.values
                    .filter { it !in alreadyBlown }
                    .map { start ->
                        val newBlown = alreadyBlown.toMutableSet()
                        newBlown.add(start)
                        var toProcess = mutableSetOf(start)
                        while (toProcess.isNotEmpty()) {
                            toProcess = toProcess.flatMap { node ->
                                node.getNeighborNodes().filter { neighbor ->
                                    neighbor.value <= node.value && neighbor !in newBlown
                                }
                            }.toMutableSet()
                            newBlown.addAll(toProcess)
                        }
                        newBlown
                    }
                    return results.maxBy { it.size }
            }

            repeat(3) {
                blownBarrels = blowMostBarrels(blownBarrels)
            }
            println(blownBarrels.size)
        }
    }
}

fun main(args: Array<String>) {
    Quest12.part1()
    Quest12.part2()
    Quest12.part3()
}

