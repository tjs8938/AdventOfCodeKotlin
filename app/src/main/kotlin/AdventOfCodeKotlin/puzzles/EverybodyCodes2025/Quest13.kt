package AdventOfCodeKotlin.puzzles.EverybodyCodes2025

import kotlin.math.ceil
import kotlin.math.floor

class Quest13 {
    companion object {

        fun part1() {
            val input = """
                1
                278
                990
                672
                998
                293
                234
                169
                194
                313
                530
                261
                710
                705
                542
                270
                633
                277
                264
                369
                902
                212
                438
                763
                624
                875
                177
                480
                659
                745
                207
                979
                549
                267
                296
                304
                862
                995
                455
                786
                139
                813
                997
                561
                436
                125
                918
                179
                818
                600
                779
            """.trimIndent().lines().map { it.toInt() }

            fun dialMap(turns: Int, size: Int): Int {
                val t  = turns % size
                return if (t == 0) {
                    0
                } else if (t <= size / 2) {
                    2 * t - 1
                } else {
                    2 * (size - t)
                }
            }


            val position = dialMap(2025, input.size)
            println("Part 1: ${input[position]}")
        }
        fun part2() {
            val ranges = """
                5592-14031
                4758-10143
                6296-16059
                7687-12727
                6420-15052
                7226-12372
                6010-14789
                5769-15348
                7208-13745
                9822-16544
                1239-7573
                1047-6851
                2780-9973
                6078-14043
                3383-13285
                2014-6441
                6954-8664
                3978-10177
                1060-9556
                9046-13479
                5672-7605
                2252-5476
                3470-7039
                6279-13706
                7466-15456
                6080-15869
                7338-10957
                5740-11343
                2731-3962
                4658-6189
                9540-17335
                2267-11289
                8667-10948
                1852-4548
                6675-16212
                5511-8726
                2459-9314
                6533-9003
                1293-8298
                6967-15683
                3188-11135
                7807-12685
                4265-7737
                5827-9805
                4845-13281
                4580-11338
                3025-7032
                3151-5440
                1924-11192
                7561-9046
            """.trimIndent().lines().map { Regex("(\\d+)-(\\d+)").find(it)!!.destructured.let { (a, b) -> a.toInt() to b.toInt() } }

            val size = ranges.sumOf { (a, b) -> b - a + 1 } + 1
            val turns = 20252025 % size
            if (turns == 0) {
                println("Part 2: 0")
                return
            }

            var rangeIndex = 0
            var turnDistance = 1
            while (rangeIndex < ranges.size) {
                val (start, end) = ranges[rangeIndex]
                if (turns in turnDistance..(turnDistance + end - start)) {
                    val result = start + (turns - turnDistance)
                    println("Part 2: $result")
                    return
                }
                turnDistance += (end - start + 1)
                rangeIndex += 2
            }

            rangeIndex = ranges.size - 1
            while (true) {
                val (start, end) = ranges[rangeIndex]
                if (turns in turnDistance..(turnDistance + end - start)) {
                    val result = end - (turns - turnDistance)
                    println("Part 2: $result")
                    return
                }
                turnDistance += (end - start + 1)
                rangeIndex -=2
            }
        }
        fun part3() {
            val ranges = """
                683-527675
                761-599246
                456-563165
                254-584563
                408-547399
                979-550498
                652-511079
                457-522693
                642-592805
                488-556324
                608-541286
                702-550675
                741-535194
                901-516834
                741-547046
                193-516984
                906-558111
                902-550440
                755-568516
                262-578271
                180-567039
                843-515492
                817-509340
                244-578106
                377-524830
                674-514237
                571-561693
                926-599576
                493-562413
                996-544470
                864-594461
                517-518451
                161-516503
                471-529330
                426-520483
                427-580805
                699-533220
                354-559502
                487-579001
                998-507925
                839-531559
                480-548476
                297-545259
                378-513866
                676-512912
                699-534627
                927-561437
                727-551156
                880-530347
                963-503386
                125-510706
                825-552578
                776-526799
                431-563710
                271-508804
                509-560982
                855-509238
                676-554169
                409-501658
                219-518338
                245-543988
                792-594406
                649-500955
                721-597003
                738-533038
                553-597397
                426-569913
                616-552166
                770-505543
                203-575872
                980-507813
                739-522255
                863-521524
                664-510130
                866-519558
                967-531396
                653-593394
                370-502794
                729-525445
                761-529464
                575-567296
                666-508818
                600-575575
                134-505682
                154-570239
                340-570229
                822-547996
                479-516018
                522-576019
                550-580175
                399-580776
                330-521034
                612-516233
                908-533018
                750-563351
                142-502433
                331-540274
                929-564794
                918-591839
                763-504861
                454-512143
                227-597135
                280-558908
                203-525288
                357-544246
                702-598121
                322-523613
                177-536878
                680-561464
                655-524289
                484-543988
                968-597662
                951-599341
                422-566440
                595-537111
                918-508799
                289-552711
                494-501875
                845-591561
                409-530917
                731-509480
                341-556902
                700-573804
                440-518017
                551-558274
                236-569766
                865-515702
                105-534596
                452-547277
                974-519258
                956-573436
                119-514643
                212-587450
                254-520830
                281-519719
                623-540566
                974-570851
                632-521720
                201-596564
                387-583752
                178-515725
                427-528149
                892-538519
                899-581022
                621-514143
                710-521300
                501-588158
                662-593353
                470-519575
                568-545458
                664-524137
                913-513726
                322-525902
                994-509708
                198-534944
                175-581076
                836-561982
                132-548754
                677-556834
                235-539504
                430-592504
                472-550586
                723-570117
                767-585241
                415-560772
                394-503693
                164-516644
                670-595852
                425-600319
                614-578176
                826-561160
                467-546063
                902-563347
                838-550793
                813-591055
                191-581417
                518-545662
                745-553407
                912-538787
                839-541098
                856-540185
                694-542948
                848-519867
                388-538838
                934-537524
                234-555228
                886-560146
                361-537231
                991-575803
                577-598877
                206-518384
                176-581022
                473-587431
                698-567036
                205-531747
                271-560231
                904-583086
                368-503380
                827-566385
                594-521048
                356-585177
                780-576660
                681-518773
                302-573459
                865-524188
                416-506327
                185-536824
                595-526390
                874-513780
                705-513438
                660-525469
                586-516261
                402-585012
                124-535359
                290-583789
                878-547786
                673-536525
                193-548436
                882-597290
                402-558435
                996-521563
                793-591801
                110-593136
                257-572254
                698-585644
                950-565996
                667-598302
                966-584640
                503-563782
                462-505379
                622-545352
                494-515258
                178-544941
                183-589521
                903-539284
                859-525592
                470-566246
                427-593803
                848-577551
                533-589313
                297-507323
                499-575304
                477-559384
                923-508356
                787-514112
                235-520196
                635-539369
                810-543012
                502-555921
                213-595864
                926-599556
                607-585536
                755-540859
                163-590564
                845-528572
                193-589599
                132-578615
                360-579048
                730-550398
                543-554266
                494-570845
                171-549090
                597-562734
                731-519361
                847-569593
                882-558030
                197-532832
                642-543577
                683-588988
                146-593445
                695-540231
                596-579668
                551-547613
                417-571983
                843-502320
                263-504653
                238-537540
                169-558091
                122-520917
                937-568310
                728-537851
                175-563974
                779-521800
                905-543478
                836-552998
                472-538342
                526-546259
                200-518994
                679-520140
                274-551250
                247-544580
                772-516916
                360-537525
                267-542264
                898-537686
                114-516066
                661-582102
                395-554418
                305-524597
                954-554435
                722-572082
                115-511836
                495-526941
                738-551896
                392-511735
                710-576779
                404-585246
                368-553855
                155-568138
                768-560740
                405-571904
                162-539547
                976-549939
                157-557828
                652-517385
                889-543242
                700-585556
                712-504128
                229-575989
                655-585173
                126-596936
                362-575852
                868-550768
                768-514121
                498-550129
                218-547065
                552-517649
                698-590543
                988-502784
                314-573436
                312-548903
                273-582827
                131-590537
                133-598974
                263-583661
                984-534610
                933-539685
                499-540133
                243-529516
                480-548641
                282-548756
                246-509164
                845-506801
                426-570527
                586-557111
                737-544402
                898-536247
                822-551645
                356-581366
                335-599671
                417-579643
                988-572455
                726-516277
                596-510103
                418-507288
                388-521873
                698-575573
                264-524148
                158-548091
                190-585494
                577-529365
                347-564653
                107-591688
                551-541321
                795-546317
                946-579463
                708-547987
                686-528131
                586-519223
                773-571419
                594-556261
                631-574110
                245-592005
                334-520859
                162-518448
                218-595550
                582-505203
                160-579574
                476-570116
                716-516522
                555-577641
                748-545110
                371-559498
                895-535098
                427-529184
                769-596533
                303-585970
                498-557093
                625-561128
                545-520160
                705-589945
                984-540214
                480-530827
                699-539066
                481-509335
                212-542335
                541-516110
                893-555211
                165-526628
                908-527944
                927-547564
                416-584578
                548-565605
                484-511101
                425-532447
                368-517399
                199-521478
                620-545000
                283-537471
                567-592297
                403-596541
                748-597223
                466-521526
                325-597671
                746-550227
                653-521350
                806-525675
                622-514809
                340-598980
                362-577959
                302-561678
                737-514229
                406-542987
                609-599119
                160-585613
                516-559796
                775-542461
                867-546334
                598-573362
                620-528704
                681-528458
                429-578813
                587-555063
                436-506792
                314-558159
                311-504591
                522-500658
                382-545461
                833-582574
                111-537626
                872-537262
                639-527829
                216-564442
                788-506621
                450-513323
                589-514941
                617-533938
                437-576847
                476-512380
                651-515197
                879-590620
                843-573171
                484-563715
                217-554786
                924-591992
                867-527627
                131-582033
                467-592621
                469-566819
                944-562343
                555-533112
                624-551035
                824-574381
                252-598445
                266-553497
                587-567927
                845-554853
                785-589851
                286-566313
                329-573365
                277-512928
                546-518989
                782-523548
                993-562583
                315-581062
                204-597808
                367-549416
                799-541942
                883-552433
                877-594991
                184-591349
                580-508534
                612-514353
                606-569536
                292-506216
                385-573550
                806-542236
                796-573235
                612-512361
                423-569137
                169-555394
                699-562546
                492-508001
                481-512455
                809-561375
                728-575213
                350-534089
                530-525846
                514-531901
                937-548057
            """.trimIndent().lines().map { Regex("(\\d+)-(\\d+)").find(it)!!.destructured.let { (a, b) -> a.toInt() to b.toInt() } }

            val size = ranges.sumOf { (a, b) -> b - a + 1 } + 1
            val turns = 202520252025 % size
            if (turns == 0L) {
                println("Part 2: 0")
                return
            }

            var rangeIndex = 0
            var turnDistance = 1
            while (rangeIndex < ranges.size) {
                val (start, end) = ranges[rangeIndex]
                if (turns in turnDistance..(turnDistance + end - start)) {
                    val result = start + (turns - turnDistance)
                    println("Part 2: $result")
                    return
                }
                turnDistance += (end - start + 1)
                rangeIndex += 2
            }

            rangeIndex = ranges.size - 1
            while (true) {
                val (start, end) = ranges[rangeIndex]
                if (turns in turnDistance..(turnDistance + end - start)) {
                    val result = end - (turns - turnDistance)
                    println("Part 2: $result")
                    return
                }
                turnDistance += (end - start + 1)
                rangeIndex -=2
            }
        }
    }
}

fun main(args: Array<String>) {
    Quest13.part1()
    Quest13.part2()
    Quest13.part3()
}

