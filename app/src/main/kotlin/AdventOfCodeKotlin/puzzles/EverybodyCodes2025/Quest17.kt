package AdventOfCodeKotlin.puzzles.EverybodyCodes2025

import AdventOfCodeKotlin.util.Direction
import AdventOfCodeKotlin.util.Graph
import AdventOfCodeKotlin.util.Graph.Companion.buildGraph
import AdventOfCodeKotlin.util.Node
import java.util.PriorityQueue
import kotlin.math.ceil

class Quest17 {
    companion object {

        class IntNode(x: Int, y: Int, c: Char) : Node<Char>(x, y, c) {
            val pos: Pair<Int, Int> = y to x
            val intValue: Int = if (c.isDigit()) {
                c.digitToInt()
            } else {
                0
            }
        }

        fun part1() {
            val input = """
                5496411395247781411716643782421
                9382923593882878521928449998377
                4296693629457168543844272539546
                3885346774531617447962897897412
                3224484778444664869399173741873
                4483555875893623546152376669278
                4953997259671936147649333118215
                3545363417364969762696731459925
                4688892231576694827931521587425
                4291724963799125446351183952644
                4349612634611121861348978252575
                4425382874281797952627252275396
                4191158792589859677322872897813
                9733892956221452221851179674451
                2597799415839813365345279929153
                967978567664944@326926971761471
                4934634238562414449372969715899
                2138472143694795192452696852961
                3239666243717192641272214855529
                6737772929985323443367686768646
                4272653285935442778642558483936
                4544624982942571897261855366191
                8335498971626581927217671771228
                5261874428146745574248464143937
                3525545998581886712395991113147
                7949135777684915716546814311269
                8811199384497654589334156779596
                5843457988513988639829468681692
                9188694122361374634276592426898
                2344312431959736134635292871563
                3956899963331324538845582765644
            """.trimIndent().lines().map { it.toList() }

            var tempStart: IntNode? = null
            val graph = buildGraph(
                input, ::IntNode, callbacks = mapOf(
                    '@' to { _, node -> tempStart = node }
                ))
            val start = tempStart!!
            println(
                damageInDisc(graph, start)
            )
        }

        private fun damageInDisc(
            graph: Graph<Char, IntNode>,
            start: IntNode,
            innerRadius: Int = 0,
            outerRadius: Int = 10
        ): Int = graph.filter { (pos, _) ->
            val x_dist = start.x - pos.second
            val y_dist = start.y - pos.first
            val distSq = x_dist * x_dist + y_dist * y_dist
            (distSq <= outerRadius * outerRadius && distSq > innerRadius * innerRadius)
        }
            .values.sumOf { it.intValue }

        fun part2() {
            val input = """
                61656588641135583524777133572485753337724387164534678235862731343865167556738112174574362472114245531
                45533345423222611612162516583322751574658214852385467428724332461663185677844185564245158765256521411
                15218185532746447268131531261721326582586847734438473362776711824575566732657154814666162424317253342
                34115713582132516783886538428361548568336514228873273327258786466588367443311226213266758265548877845
                62442622666427872216455232817532314542583312862184878813721676825357637572862746633142353357732837516
                62475846224478416687158343172844754235365867232858875481668788186286464422325638546553322228217158713
                76673177255452681856874645587178578856752558528558751456715258477631614273171276134622371484366613168
                27725518585532585882385241368123164256636422431256154282431873835431568123885336327873641371732637814
                32834143516168867442165176532372173135477661133836227366316521678152283444815878236184618351214373781
                27768828143374718624856862756561386541423654472682825848186158833377486463756715652181413766186282528
                87134666275465651654772851128663741424817442446662567416886618382127578361452831545885323526846821465
                26551352272844434552276357615858431825614417699669657747478512351463211683433788114675586656265746162
                82175458221523342131384255782215437885745858796596569947764868568742576871516443734715173176116754253
                56613858784677561446555652424836526647975866875998974859967874579778515356331365268113413542546368446
                43852123241373437322542335517114587975884578857887956556454497777589847166811874835344811175116654343
                26786816665217247632312156415225499548565756446954867945447687686598577744518664727361134862435175124
                48751535174276677342625515515349855547669855745676767758496875989579956857663312256367883367566242473
                33825124554117251376248232867666555747747874687994589646684969875474574494857223283143227541452158266
                48237843257476741123287538657664949996465458788984587756574754577969954555974224584483747375158613377
                46388248822424767567241233484954958976584587987985575578965764466784698576866837662658385435165116771
                88212158687651287687275146895444654897847475969649667458869697899678799776688388365123365525888186256
                83426112742432487622341855574954965584888797994658696877984569884759978445598453525748712583717846782
                41683536383512748161869755796859555679445479667999479756955786798867947869449679835218231581816138758
                11257258722558522851445466476658467564555688499954978685494858699697596558988485556511887245774774432
                42361671244681512131848597567769845456469775578764479598484667888657574955778596578845485858828122877
                18515867574588668788565784487955857985855557776985547447464675955494594446498964857367777413826618766
                48878583868112776714497686974555866898748797997448785668657989784664757687995944899262738288382843277
                43788637227262128769466544986576487586967485879945894696696884954944959455477674756878386565388157566
                86178155353478125899964997796754947675487468648778965965667875696544566897976869768698572141457366434
                76745474626423642848876997465976855786977794486894756999849849448788585848958567445761755375257468375
                41874216845365589596698987685885649747967469677558796546997687776999448856988758846844465671754711638
                81238524872231669854496574784548775749979545879988794775696795494679994894895479759968435387571325164
                61112438483667874665645757969874975655654687756469794869968987687967968476775646694996864463572625111
                84432563353625667955977546747594587897576667799867497554668795545699977955888554959784766736785736861
                35862125817611995468545794759644478464656699646996998588649699487694599449986659984797491167756546548
                57751878371266685558658877649565879866545697468494549576869467674655477795758949957855698511531561532
                68136572215855987445748956447559966698477695569955547874458994866455698984869898886587955322652883732
                16833844118554846455874494699448956995844947794995667898756479868846676959959979498959958136663373523
                41445824421556899477959888879688597894994485554844566549799764865459797876946788996967589248233153825
                58824735156769575485754698954597557959596654598698458788984849599887869684874467697858746638532453413
                78283614681364774668595466669548744455895587564977667467678589769797455747488496698899844974877171264
                72638575432584548877765994989584649448686967985877664456697664857656464694775465557489666637217662853
                68512418548575497777546486494969476478854879856965959455877946975765975684999459749997484414431865176
                11538311875587445689567745487675496656797977655876545869576449797568968964656878678958497551465864765
                31866762473864595699897749667559599868599655866756987686647679795996488796785856859457797941548561664
                24678557417679494666886598576976687787978565758869554669698995576864897776847949487878459981756711147
                28788838158699489786997588454666749544884968887796976749544949895848957884659767697569689548737741225
                45786148722479894655948854785444974588957445686446778754967785447748985484789555485697755942161551667
                56126475777854575748778477589774444976579675685854764657866467444794857649876686864456958474564128838
                76241235251874574549574765579688968845999697667957468969898846577777489889748665658446548757412468471
                88465813814959468587984598658975579668796486595598@49846657654999896755479979759947547986488421476764
                16242422874597998744775874495869868944859854456859596774774859676687579688659474965498657657716886814
                84584327683458444887668549665954448856478957794656785486476488997877655878948657555595796455453775242
                55246453415458858877495457787876567866486478898757477966594655647469556445899894978875547493388515233
                58353284634487698596688496795856458465875567489589799699765547569466478666648746758895577696465842483
                62282388766557787887499689458797888747458497949879588599986478574954786977967794485976969853874382466
                33355248773648744687976654988599788876974849586648557866656879444889688849977795967649899851855557588
                85525624144869574454874969695865999658568948877468697586566749684655545465675764495495577645351362387
                31715476718597954595788778887858998548667879868574469449886944645975669669488664686755796855734776884
                12372266843448847596854695469454685674684445467549697688887598847697859864667878455667868968312616861
                44518244237896675658889446898555879954785875795579687648844989889558847464898678999978795413821427488
                31657253668848774956777784798574677489449999495778986665644455758786744957574568695459986558116651865
                61846617124269465996996846488978887675567546898848597754967484499697967674688875766464868517172844114
                33848361263377889694497448499477786674779998576588646998955568959975776578659967658568899551838448215
                67453681743217778869559458478486885959476545764454876859694549685795975868968767755759858111784453262
                65755186345478584474999458868896495455476647477496887585468467884667579984596695658687849354412653372
                88417531518217755954656686488555697947488675456686786587776564477968478766699574554679856418875524224
                54463842671827679844877466859879496469448947797567455967997859574578965944856844687447792643683184433
                55477256565436698969788464864495477774448765787546896788877764849444657668657764857794424527876464733
                78656442542114874984875669889977968749464957855475477754547957649779577844756696757489851112543326446
                71186572627368439579557875985568889877576879595796895895798475684745896458989856446988273657285517323
                78773435815821648447955756459755458684957874975894579797664855949969479748555659567694511761132576114
                61712564634421436896966596887566768477584866755677995957968885494487498595576847896446554637641786224
                56427851115886166957544975955874944987879575759799755586544799948557848846568986474977313323748732224
                21578385853324256354598947855778854464698886468988767777859864866754787588589896455674483864715818212
                48843452581852151469688949965678774646746596665496986486887747686487597587757666648437246213566275335
                62312688646357213118884584697458667866976999896549769766574998564677976844794456554271375472247872837
                45632457452584588322559847765954778875686989765674777664578765444596877596799566731345465161423437527
                18767232456226117821474498848658546855548698586784669866748959946644488847766555847777625358785518551
                32834583681651138421527446744997564666679684575887849695988957456847744864566978782777542746445252822
                31228754772255188641337855789879874596976575688697798766779447459676697478867567612885864544583572723
                58272236631778455526683636745996494956984796654449689554959946768865546879956567661428472441874236367
                12333456228427158828344754489577446888977588476594667494786945669497645554876654465412584676821163273
                75321744717511431644432128686868874779466958545977575859756844647448656967762642862844387854462753385
                53552125557785773456336427786845945546467786658849768486664998664588575767344222476513364654541236688
                73388275551736477822758757466459896569589968474998747768756588949868548687854535413253865251173241171
                26758276187484565424131875164658776687647985749564844466477954574857757111625411457547571872582471471
                41837118666541823337284847211285846589778796949576477568879989669645681451382842816453832475127721737
                57758665725323454568721648588424121445486548449654889654849769495534854647137155615584486787588171565
                46638255487758817587162251651248254875484597586995795946855786722423352444228778288457483452555675373
                26321847772487147254545215226323141882677646944877598947765424573762812771281766285658511783324341618
                22828763228551722116865732343734243368264346586747865175863488275272515474763516827114815168383735722
                41533822446234883518165658568125142616615584315838665542824883372514843668633287285516528846877846562
                54827541631318833757888776152733173662666761334667715117843742834626438571332838351263411672731124441
                46581363721465685886632242566152611256581487413651337537558572248285542542831657228768666147187772221
                25527688752741521582183637356862774811112377838666637514764268614273413776767213242748856158324312523
                48825118367218385372773526277818834724412645656778323847458375548344348513872256385811381427314827535
                46876446827323276817872282165388868882443518418433173811577512116437456341368337545142888146572544363
                12571378232186526111872166513481587277727836851612658172134375521531642716548457651426718315281764452
                51543225821658341784243535338548856846527462146437134552727748458847623438441536121471566732341251632
                56522635146816872716665456318623612536181111277127387821112575564852527177877332172814452224813246413
            """.trimIndent().lines().map { it.toList() }

            var tempStart: IntNode? = null
            val graph = buildGraph(
                input, ::IntNode, callbacks = mapOf(
                    '@' to { _, node -> tempStart = node }
                ))
            val start = tempStart!!
            val distToEdge = minOf(
                start.x,
                start.y,
                graph.width - 1 - start.x,
                graph.height - 1 - start.y
            )
            (1..distToEdge).mapIndexed { index, radius ->
                index + 1 to damageInDisc(graph, start, radius - 1, radius)
            }
                .maxBy { it.second }
                .let { println(it.first * it.second) }
        }

        fun part3() {

            fun distBetweenPoints(a: Pair<Int, Int>, b: Pair<Int, Int>): Int {
                return ceil(kotlin.math.sqrt(((a.first - b.first) * (a.first - b.first) + (a.second - b.second) * (a.second - b.second)).toDouble())).toInt()
            }

            fun checkpoint(pos: Pair<Int, Int>, volcanoPos: Pair<Int, Int>, curCheckpoint: Int): Int {
                return when (curCheckpoint) {
                    0 -> if (pos.first == volcanoPos.first && pos.second < volcanoPos.second) 1 else 0
                    1 -> if (pos.first > volcanoPos.first && pos.second == volcanoPos.second) 2 else 1
                    2 -> if (pos.first == volcanoPos.first && pos.second > volcanoPos.second) 3 else 2
                    else -> 3
                }
            }

            class Path(val pos: Pair<Int, Int>, val time: Int, val closestToVolcano: Int, val checkpoints: Int) :
                Comparable<Path> {

                fun nextSteps(volcanoPos: Pair<Int, Int>, graph: Graph<Char, IntNode>): List<Path> {
                    return Direction.entries.mapNotNull { dir ->
                        val newPos = dir + pos
                        if (graph.containsKey(newPos)) {
                            val newTime = time + graph[newPos]!!.intValue
                            val distToVolcano = distBetweenPoints(newPos, volcanoPos)
                            val newClosest = minOf(closestToVolcano, distToVolcano)
                            val newCheckpoint = checkpoint(newPos, volcanoPos, checkpoints)

                            if (newTime / 30 < newClosest) {
                                return@mapNotNull Path(newPos, newTime, newClosest, newCheckpoint)
                            }
                        }
                        null
                    }
                }

                override fun compareTo(other: Path): Int {
                    return this.time - other.time
                }

                override fun toString(): String {
                    return "Path(pos=$pos, time=$time, closestToVolcano=$closestToVolcano, checkpoints=$checkpoints)"
                }
            }

            val input = """
                6854887857656876877567567645474584667865587678474654766644363735356574544736344653767473364545373454637668755888867785768665756754787465664577656788457
                7776578744445688785685875474568776575775476746466755535376653545453747767577346433464737757654633355755568676444566788576568845855756776447478477548547
                7547664746876878545764756588785884767444657666444477567454376463357634364643675335655447647655443454556753345478567848674688466547456487665874747684564
                8576757745547784476655565778784868787475664473344676646375434553735554563545634366636765744735764455377554674648858886777577648876564567865476748784677
                4767877444575486678886545467645678486657673656364757365653746666775545755546544565456633473446764534534477436677467774444774687477454676448886454878445
                7674676764566678646888876777678655555555455557576377646743465333466575767464445435474547563467463366656744643666776767656456756546666586557764547458645
                6686878687757745448454546784745585863354776643367343533446477373463743346374535336756464336463364444756454477464375468545664574848567867486474747545665
                4764567764776446655755654565564745746657636573546756576353475466566643473636335745446757435553556537766645457737333548585548854647558544455564848748465
                8668578578455675445546757676458783566675634466474774346355357557745637764111111176557774754567463553334455433447753575855447757777657456887868857678667
                7876485848777687668588875646565743434766777374373557737367764376737571111199999113444735767636467653737756375337733565774475688757854447457476578846677
                775877458767866857556848868444464575345374347574753545643444643443334199911S999916775345653443636746365655764676753446453487867765654676775665757757547
                6464885644485554856475764574346333573335534763634634365473363544563541999999999915336343666646736434436666345636336644457634777848685846844676567775655
                8785687485665757768545844554554437757564754374574477777533747747545431999999999913665433576465367367353776774453657546463664655748744767477467668577778
                4785886455676584867658765545576564454546467767554655437663763675547776676999999413657364667375435476447434743565574573656433344778448875776456575865676
                8465877755555778548686845544637776764643765777744563563765465446545774745399996614536645534356645744757737677745773436537575773657588557584847478486754
                6866755465858855446885467667676346434537445363537345364634366467747544453446354555555565336654353566736766565477544676775334635454778547876567774854657
                5854567668888558445747374676555465333534766776343553746455656445755667374666564373453635365533755744545534765465663747673457667654678686646786776545548
                6554588868678565865563467463675347366574334567764657345667535333766747337545564545535743753537636643356656765453546466557636643775687486847777486685548
                7648564577778655446557673735767767466565354635673365533647646757663555673534736435336475456656374663374365677757545775644735663545564857644765547776574
                5786458458686878588665553777357563546636373357734743773763366764455566574474334665553535743734476773773543445656564467545663337455354574577864655767786
                7868888577787874767354457447436734764473665656776336364553367355736647356443747666545676737544665755376454377434674365336433646643336747558845486468577
                8458876574455748864753456357477567766556643537356466774376465375755653736453664663373344357575677746656756545346467477457435435477556658774677464678674
                6877577878888846473566674637664744434645343555443366475773666653647336373426567563557435345757566734664444343744656564474766734576737345755546558755447
                8886548558864566764447373746747363364566575736637477554473466433734546234353426446434535543354547553475537554443577676453764463465347566664676777764666
                6677588566787753334744756443364655746656373643444563756763644624356333566326353344253636257536366556367634556465573474677564657336543665774847776747444
                5778885677556677656744646554366765436547653756335437643364242436422456262466534664335555442336433755746577333443765765374674545576476757544756754867555
                4768558487867543657647543766547677645763436346464335643226365664253243345263365335536245223443326435737455377634455773645574555547676465755674577554878
                7877467546766643663477453373477336574364545774447565453363623365452335332466346255343233646446425244665574746663753363344756654674675747443675646774458
                4744444467874334343377733773433655663633677443666444544436526363252564262524635365465252264434563635774756344357456647574634777535747634647384647447456
                8445848675567553557535667375646354665377745645366364353246665243456542254246564325662345253465336323466336633754776535677575655675337477336554676857564
                8585468877364556557347474743654345346335564745722222564464534435352266462364465226623226526425645446543465653335544535677773474654774477674567544867485
                5445667564776647463436334673663557474777634356634352354426443622443562235464432556243462656345366543556653766475575357554366776357676364436643757776457
                4477575665375376656755675537767653637374366556443526635226454442656452654422644336425563323525224265326263545345376574573335634573635634537534588864674
                5855865474636745654555565475765477546577745523435454436655322566246256353632526454652453465256346632234354556345466764753465475336373363764333376464585
                8456747746435743663735463745457454765755732435324544256363246345526622642546254663624653546562442343644422542645336743745566754677657364436343356887456
                4864867655356343766465553657345677667477356364366343252655253532235432462634424265635254466425344562246235445563634363367574533434444773475663676544885
                5765676746767344364445545677336774774745235464556234625562626434465346345665546552262663424366652345663246355354377373765734446535433754445356667567476
                4884444736466457574744335736637333543753243653252223524645263324245262243453363435222236336325654362455434522255544443645743667463466664547457756547686
                7768453667763657376677553564345553576626656362226364252625644322436344436256345655424223226534625443353436562222637667633764457664737454763436654557546
                8484743537464345343453644546456457775334423645252264366533224223323662555535223562345322465536442233624666644232463765437364647757657475464553746764465
                5768564535777667543463745554364333346246643422342346436353436245526432363522563626556234635334536325636444232365334375664677667753345644346445667634846
                5444536575756343357753365756576444762665454333622462332644645564464556255646265233344665444526234523432646563453442344673535546555655373543366637478877
                7664377573537366563556374656657636366565324224663346355566665434265544335342666226652264362424334625623562326444542543765667367335757765575657674745564
                5585355464337353345747447574735375426636336662355225262345326234242235453336432366542352242245666656225365656466455636677635366655453455376534367755874
                6756535643353355334464757357535736365553254633525536434335434264456324262664565564333333623336365666464254363566242554454653355564464667656575735774664
                4473634333343453643636676765473543245246566555232235652645464345426543335653455633544226462566635355244352444243233664357754337465466643753766345536586
                8774746733737335764464533665677336355462332353335445624424325364625426624424264633352365435535442543342665222524423643253663437464753375777355365653356
                5353733573376763454547633356654253622533636536335236234452563254523225255246635653333436256352525335253543254223546326436745735754673654435736347574748
                7656434657634463777776666354665424366566362655542655646523545636342245633643233624663352323234263335322564446664565465335363333767546646774477453446546
                7743636745335633536645455777332652254454233324356252662446525343354332323244243553443623423356435542535446556453353253423434335354544347753637553343565
                4367633654677457757453447465524646635336666662464556635333532333354342322233253233555322543656364526235366432236635326643247633636443576366434547476546
                7357644473445333433646444576652222223222545436243332246265244422523344344445335344232525636545266353523233365222563664645635535547456763536554367565557
                5453736656545747476573746533446624634366566422533656644655246535322555253543425333244352325636534342324244545654345536424644566763357476746347545355755
                6755535466673345436334664475556333246235355225334622352526446542324343343525555454323344232263442524234634326623423342542252336437776357477643363333373
                7653447747553743644376544565564532324344454625223564565553432254224342342322235233352552532263234536566545626645533363565365654757447457555363645366453
                6675373745364647543536663533326542446426266436626563626522422454325555552254545233255234533352552322256234653454445625556522367333747476536434667635337
                5534553534456445475566747432662644224235543523324544262444554535224222425423352333455334342433353335566365536556235226324626464455456533457536453557766
                4473634354364456446766354522566254454336226422346335633455225244345332355233224432324322453554364436433424245526522522354225653774375546653674443363774
                4567366554733474346653343342536355265363262443232223555343325224332344242543332224432353425423343333232544565335645626645562533356557347576454643646356
                5365633734445453644743434654665532232623324434462555643435234354325342422233544232433234242243334445326543543332642542654255467367644343337766755533356
                7577653753474556534644634324246225444345426426254422325433444235522345222322525433552343442532322246526446263465423545626446533444655567635565345334446
                3555445774575644466467754264454443563563622235352266323245435253423232454243224525234424235524243546242536245463322355664426236657674743334364763447437
                5736736473355744534374756634555526365555552363456456422322445354533223342245444443325545325434235426335545364245235645535446243455773733773465347535574
                7533763654373737475744442646453254462655366255646555244252453354322342542423353234323553352253525543254544225332263465422566443653567467367667534743453
                6773474643656577576444773266235255443466323342523424225344353252354425332533442225433455322434243445652255346256256436363525443556556455676635564647734
                6736556565653676457365345553545253662235652255464624253422355222555442322535444533532424534254523344622352532246233553332224326577433775745355755757743
                3473454666753747455756734546532562223553345463634433543354343235255225325445334332234232445525322324233646524636464546364633423537737645453435655376763
                4546573737763737453635753242663546224455466424662254435552432252332332355525245233522452455235544553426654234562242455366533544557736743346673347455546
                6767375766457477374647662235546352462544442246245655524534535253335524443452525452353425543322323454363653424456265663624356524367565646553465534666767
                7347753345444734655557432234364532646635656535422455335355332422523335222342254443354252442552553524364636256535333225265666244266643533474437734475653
                6636675645734356676377324356444522522565646363323435352352324532555533532225335445255522524343535254536556563424362453355426665645543675745554446336764
                3744456535465763676774463663662424266342222523444234222435424243534333424554524222435242534333343552254332223224566644336432325375756767437547474355635
                7645454674676635555646743436366646453642546465353553444455255533453344222233423445335543253453423334346234363226655443226664525646553457657375476775736
                5634474347467553555466765523263352634536622342335532544523335542252352254223545325443553353322252255435534532645365243536234566677636777655553347456435
                4356663545537633553653664644453233552525334633425243255522324544352233535225552445323335233254254344446652562446636245353545325245667334734566736764356
                636463537353755643675762232345632532254445563424224234532342333223334224242@252223444454324434532554422363554524254236555562336656556553376755574376664
                3665677735433766465357423523222256652355322565663232423325222442453423425299953525423534225232255432325534463225652653535526664634477736457436734545744
                6755445463765655734577665255623664253423652246334443244423542452452325443399943354422444333243444332426223223354262544455323322346655655553445573573655
                7337375564377766667346764235632452663223264655646345424555533554532544255299945252555455424322345545542426452464263323265542636534343675673533774345555
                6777734663547334653765662366646242464426263222235432333345345345453533522299933345442222442225255432343232656324545452434642442673734657673346447547664
                3743543753575754746657442664223323244465466226534233535334543335232343433299932443344535233354345253253536526455645556425232365674445476367644553763745
                3345445566756336435533565453332265532356342536652653345452235522543323232599955424544354442555525222425265433666566446245435254335474744633633363774756
                6456534676337547747636452344523666444536644333652232254335334525432432553599923454325442224323523353436225563523253624426626234563447435666576337566534
                6653365647664467364777422363664266654225652556435352342224553444344522223299934534334352242553445552463653432456652432466263523434654557334634344373643
                6635567447455637473633334266225236234565565462635655235354235353553455333599922523255422445525555422564464254326422234434455443277564545535754347355536
                6553436466375374533553542555263565452356262262236463243224445234255245542499945432333254252423334344652242455435664535563244453644533344645734435646344
                7433354533736546473633576643356344426532454444365642524555245452533225534599934553435444342325522355644234652453265526642642665466544755346656343755465
                7663736633474745545635656354224543365522654535364554343423244534245522345399944533524533254223433323242236244433242255533562544434466446457375364664354
                4633647647636673736737544352552233245552332233362343524254223453455445223599935444554334255232355424552236362543452656365635465734756436544536446474453
                7736374577733537534763554343235424262546422635632345344533342223325455424299944255345433443252224362632565346446362535543625665447557363445775563565335
                5365636565653474467433546535253364232463445233533222454454543525245534544399952445335224322534533642633233622555433242544364555775636464376465677554655
                5775636537547655636555744536253264233534325463543255324455442235344423444599923323245452344333324254353666332425646455252662467466733673335756534656575
                6564756337644373746375667655453323426552544646445264254435434543222225545299935234323325552353236646544652435635552462464423657454355743475754556353565
                7673533575357644356345346456553333354326564355423665364635254343223432252499952442524554455332553533235244464422452242346426676757353744547446474344753
                7446344553533557343335457524354653234366625365563254522463342453234542425399952432245435223443553462222462252242364624254463567367545573333335357576654
                5576573546346555536664443433436326224265255355436645533566355422324444523299953334545535544352334434436624252245345562222656647466375455777337735477665
                7366664756575754474435667673345242232353353423526234233332344243522445335299925423334225254254666534342364264453434362624534767435435644553375664775474
                3734554777567767573744343532543425662354363244346235245564542535523342443299934454323345332366322655222464252324566265546656346545634565533564633433664
                7544664656557745666567355375222642666233555363344536364453643354455245254399924554435552343342552244465654634344465452552245566663477555663543575567536
                4674476764774457447356646743236446344432243564645533262655243356443432453499944255322453433223354462454462556345465236253226457564675456555373537657665
                7443436734336336447333347355335254462233566235355226362656235525562524234399955232445344632445533246342653364462436362365454566533773343466646337764375
                3647345734743533637337563663345624553523363655646265555266436253664534424499955436635436553646652652546563236233562533435634357773354337336363454664764
                7754357647774755656563657664534654424364243252623346452454563534562225334399933635334435263443626334534255456323334552436656555364743475533333344375466
                5667336466545357763364665537543656524626463555245423544665234444464566666499954443226323323265256623264542532262354546624536636373376636777554354437346
                4566763734445733673675774356756344554245446562353422653634325235263633255299953465654335445653264425666252452255446534636656545343437457663665777557575
                4737576636343776743573647745435423265343326632435524345443322456256233335699965453533352664536332644226322554554556552677744564544576647667565473556585
                4846735455347573745546743436576543365534424556434452423443455444542234335699946542632355245646255434625542354563542244547463376643765656565374373464786
                6776665674454435475643634557637436342523243225452222466356652425242324225299942452236252622436324556332644443465424445675567473464746757746435434355448
                8747663567336543357374337364463374423423442224432422644626334363245644444599942343353345632523333555625625323553443537357334547335353577345474647743765
                5748666777667337657346773754677433653336236356366262433433643653664246264599926366654662523354322244254565623552243367353556453333555764347346635744668
                7567574566756574334736655545434674342246645424334562622562545242654532365699944543464562565535532335234546566222425354655677455744754457333673465548575
                6564665736365447337357467464347663735336643623664253325635333332346266422299944523443543256326425456532356366345357637457553663534457637363444337456545
                6744533577533354354757476676333644575453556236622665354536336243523536344299964335663522464246262624543554624242273645744434337675764745664676765447844
                4844845465573566564755355664456444654773656436363255663342535645336533454399936424435546525443422635235243532324763364334364355566655463535743646557864
                8887743554337557533566655674744334633374453634444565342225534336525562236499942555525522255662656464566662222644737564674377356453544574457635547565857
                7565666765476557554553557573674456776536466553252226653443353445644226532699942436262425435444434365266622433537465464346376774347336374556536757668458
                5785586364463436657546653647474633544776642424254466454235366623232234223599944654333222534363333642522524663667557445763534347746763775655666758477748
                6788664533673575347434563667575437775767754652425652633246542422464253365499962455436424454264353354245345365653635554663664445744534465733465784675568
                4656576854773337447464755453534374346734653355426556462323443442525653634599934526622622233466663365343255446774744554464754547764745457757565855585648
                4656657465755354663637747655457736653564757474464242663645232432536424426699932426525565363244255654435644436567645537347646565364344674363655657747746
                6448765657437375334643465363566756763647546576462323352344344446345622555699926545634425652332433242424544654477755374357454367636547665664534877857765
                6447888788766344334473357533636557664747363644777462645456352654555343335699925446324322654265634562654645334755663377736556356737343776775344785676764
                5547758857565376573545766645435767757363747547664553542225664533362352654299965355336662232244543555543754673563553647373357435474566767765575444574544
                8584747586585457653774635343774346554775666476544677456624245462353242656499942624433643333224632363734473744335357536334547345576564646337575585484745
                5658844667885677375555345645643677466475475663436574445464344353544634465399954262632643346524636754377653576347447476553553377463644473438675857877864
                8488485845876656754744357446776774344377747444463454537566626355535435324499945323326466554637754377336463545373563543374674564645557447664748755557574
                6576775465846444767666637573655673554654445343546733477745757355426465364399943352346226445566367335773353764377476675766763357446454536554647474574657
                7446456788856447743445747455443737356457736564454333636343553563762332323499942342553637674765435757376375447636674743664475543655436576446575466678747
                7557884684858774377535365573733456755437355576464647436635477757353346437399945756545673766345437774433653567377654575466734645644436445784645788764665
                6664867688846778657356673556355757347533354463657754435543763777346563756799953474776467653674667757346643433476344753676433653366575647486466584657857
                5764555684677465666444544673736367563654357433367655363365534635664457544499975336546744377736474443464453663675537474366356675435557556445444667874876
                6484878575484447567766654454675665666567364463566674647566774465576644567599946345567456443533633465775575534335335773344336643377476884455878444688668
                5684746746774875586873437453775377335657767454563357447744533475353444673699945443364767753343464476365345664365657334363476557355565758646584848486588
                6688567758454856657656373643356566737356344345735567775563457554656343736399933355477657347775747657336774457643465575467763757366545677566886456885456
                6546688867866445747668464633566745744455765377476763467364373453454655354499953643454344574775433644365374776736476554444537437647468656485676756846756
                5748866666888445485848763463447766366555453665765667733537577433673446377599953364364666777675654563444737556355546357464774736658875564678688848887684
                6577458566486856854675565663567657774347545345734544665653747335573467557699936635333467373643576476737675356337633366744465766784677666845757557758478
                4764486646777666545745687533644657557364645477737566765347767664635454745499966377376464473735377465443665733345346473733434576665575557467585444745875
                7768664847767688675848466656735755345634677743535667344563467737764444755799937644335667567734444633777536735754356666454634556667866886844658475554785
                4844787488568788465658675588733556676655744647457537537547577345634354673599947467376543376446735533557667546474376554357534884754588746465868685448465
                7566676645668766866744456856574535576436754664675457434365556577555735563399963666434734575455353537674644464366573477745675586478554577545866586584556
                7588547766875665677677878585885473475465743543576346756674474457757444544699955777754676673635776653753375447353464566558848465865646666475848557848577
                5687685778447765758676446568855455363345644434733363635447334774455577765399945553567565336743467334377457756445374335558687488847568654584845678444568
                8575646666648857746745576847677585737476433734333545464474657364653744775599964543466646736765644757334567346564536374648655868447588686656644675554458
                5488545454464784457668677847845854643645376475573777465465467375366665344699937764754653566354536445776535564334354755547575457664748687656767777787648
                8475775645845686758888857465447786878875535763634746557447474775574376745799965746747367746375665745373667646347565456568665656578874848886884477888846
                8555585578468546584778755748887457866876376435665333653444463663337476447399954346365446563553355356636373575758778774887645887567485667465848758544644
                7474754575656448665647777848864856588488567447676767466677564457634746776699955533373753464433656347333444564854476676574746455464774676448548575575487
                4677567476777444747754646476474478575856456834677636346345735344444555553799933374437447467563775736555737647888748464464654767654876858888488784765447
                8554558546565448778777766446846478544445858757756747535347665643566655435499967464774747353547663376373747544775475774588465758867476685886444665575878
                7556686785748867575647458556788487455864747474565663374336353375634357355699976465645754673464374656575478675788848786458768446446645456566487444467567
            """.trimIndent().lines().map { it.toList() }

            var tVolcano: IntNode? = null
            var tStart: IntNode? = null
            val graph = buildGraph(
                input, ::IntNode, callbacks = mapOf(
                    '@' to { _, node -> tVolcano = node },
                    'S' to { _, node -> tStart = node }
                ))
            val volcano = tVolcano!!
            val start = tStart!!

            val visited = List(4) { mutableSetOf<Pair<Pair<Int, Int>, Int>>() }

            val queue = PriorityQueue<Path>()
            queue.add(Path(start.pos, 0, distBetweenPoints(start.pos, volcano.pos), 0))

            while (queue.isNotEmpty()) {
                val current = queue.poll()

                if (current.pos == start.pos && current.checkpoints == 3) {
                    println(current.time * (current.time / 30))
                    break
                }

                val nextSteps = current.nextSteps(volcano.pos, graph)
                nextSteps.forEach { next ->
                    val state = next.pos to next.closestToVolcano
                    if (!visited[next.checkpoints].contains(state)) {
                        visited[next.checkpoints].add(state)
                        queue.add(next)
                    }
                }
            }
//            printVisited(graph, visited)
        }

        private fun printVisited(
            graph: Graph<Char, IntNode>,
            visited: List<MutableSet<Pair<Pair<Int, Int>, Int>>>
        ) {
            val red = "\u001b[31m"
            val reset = "\u001b[0m"
            (0 until graph.height).forEach { y ->
                (0 until graph.width).forEach { x ->
                    val pos = Pair(y, x)
                    val color = pos in visited.flatten().map { it.first }
                    if (color) {
                        print("$red${graph[pos]?.value}$reset")
                    } else {
                        print(graph[pos]?.value)
                    }
                }
                println()
            }
        }
    }
}

fun main(args: Array<String>) {
    Quest17.part1()
    Quest17.part2()
    Quest17.part3()
}

