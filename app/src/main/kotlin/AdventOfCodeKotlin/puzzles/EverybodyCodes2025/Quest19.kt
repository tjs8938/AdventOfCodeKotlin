package AdventOfCodeKotlin.puzzles.EverybodyCodes2025

import kotlin.math.abs
import kotlin.math.ceil

class Quest19 {
    companion object {
        fun part1() {
            val input = """
                10,8,6
                17,15,5
                21,19,5
                26,11,6
                36,22,5
                44,29,7
                50,21,5
                60,10,6
                68,19,6
                75,25,7
                83,34,6
                88,27,6
            """.trimIndent()

            val openings: List<Triple<Int, Int, Int>> = input.lines().map {
                val parts = it.split(",").map { it.toInt() }
                Triple(parts[0], parts[1], parts[2])
            }
            println(openings.maxOf { it.second + ceil((it.first - it.second) / 2.0).toInt() })
        }

        fun part2() {
            val input = """
                13,1,7
                27,1,18
                27,28,5
                46,1,10
                59,1,7
                59,24,5
                77,1,18
                95,15,6
                95,45,4
                117,1,12
                137,17,7
                137,41,4
                160,41,6
                171,26,12
                171,67,7
                195,47,16
                209,27,14
                209,86,8
                224,40,18
                245,60,14
                245,94,6
                259,39,13
                276,24,9
                276,87,3
                295,44,8
                323,9,14
                323,88,8
                335,23,13
                356,42,13
                356,65,4
                378,63,13
                392,43,13
                392,104,6
                406,55,15
                420,73,7
                420,87,7
                430,82,15
                441,69,8
                441,116,5
                466,39,15
                483,23,12
                483,76,5
                505,46,14
                515,34,11
                515,75,7
                544,57,14
                573,91,11
                573,121,5
                586,101,10
                612,68,15
                612,150,3
                629,83,18
                651,107,10
                651,142,6
                678,75,14
                704,100,16
                704,118,5
                731,128,8
                756,156,5
                756,187,4
                768,138,16
                779,146,13
                779,184,6
                791,125,15
                814,103,18
                814,176,6
                833,121,19
                848,100,13
                848,159,7
                877,73,7
                904,46,7
                904,122,4
                917,61,5
                946,24,13
                946,119,8
                962,41,11
                976,57,13
                976,90,3
                988,67,17
                1012,34,16
                1012,123,7
                1030,57,8
                1040,66,12
                1040,85,3
                1065,87,18
                1085,58,19
                1085,142,3
                1103,83,8
                1125,100,16
                1125,134,6
                1136,114,7
                1161,85,13
                1161,172,7
                1190,113,8
                1201,99,6
                1201,152,6
                1214,82,14
                1237,107,15
                1237,127,3
                1252,1,115
            """.trimIndent()

            lowestFlaps(input)
        }

        private fun lowestFlaps(input: String) {
            val openings = input.lines().map {
                val parts = it.split(",").map { it.toInt() }
                parts[0] to (parts[1] to parts[2])
            }.groupBy({ it.first }, { it.second })
                .entries.associate { (hDist, holes) ->
                    val heights = holes.flatMap { (vDist, size) ->
                        (vDist until vDist + size).filter { (it + hDist) % 2 == 0 }
                    }
                    hDist to heights
                }

            var flapsToPoint = mapOf(0 to 0 to 0)
            openings.forEach { (hDist, vDistList) ->
                val temp = vDistList.flatMap { vDist ->
                    flapsToPoint.mapNotNull { (point: Pair<Int, Int>, flaps) ->
                        val (currH, currV) = point
                        var hDelta = hDist - currH
                        var vDelta = vDist - currV
                        if (abs(vDelta) > hDelta) {
                            return@mapNotNull null
                        }
                        hDelta -= abs(vDelta)
                        val newFlaps = flaps + hDelta / 2 + if (vDelta > 0) vDelta else 0
                        hDist to vDist to newFlaps
                    }

                }
        //                println(temp)
                flapsToPoint = temp.sortedBy { it.second }.reversed().toMap()
        //                println(flapsToPoint)
            }

            println(flapsToPoint.minOf { it.value })
        }

        fun part3() {
            val input = """
                24081,23524,1338
                60889,60182,1411
                60889,62292,930
                60889,63499,664
                159216,158257,1892
                159216,162778,1250
                179076,137872,1454
                179076,180999,835
                222456,181047,1330
                222456,184752,866
                282296,240790,1412
                282296,242698,587
                282296,245549,999
                381615,340430,1267
                431677,289429,1847
                431677,392264,735
                431677,394172,526
                516110,374294,1127
                516110,378647,1545
                571681,317757,1908
                571681,431447,827
                670043,416465,1127
                670043,420764,1127
                683790,401914,1482
                683790,432783,759
                683790,434465,1237
                742419,343340,1507
                770404,315487,1210
                770404,373077,525
                770404,375427,569
                845185,390057,1381
                845185,393607,1302
                894906,339693,1576
                894906,441904,675
                991139,243439,1238
                991139,439657,690
                1058264,176158,1395
                1058264,313044,636
                1058264,313995,502
                1134701,252479,1462
                1207285,325204,1475
                1207285,327433,906
                1207285,328287,825
                1294323,412284,1723
                1294323,417027,830
                1391251,314388,1871
                1391251,511089,887
                1454758,377954,1658
                1454758,381670,1784
                1483984,347801,1644
                1483984,410009,850
                1483984,411539,908
                1509872,374012,1263
                1531198,395252,1522
                1531198,397612,611
                1531198,398993,1331
                1579976,345713,1701
                1579976,448074,1054
                1592134,357942,1387
                1592134,360260,565
                1617782,383325,1949
                1617782,387962,941
                1668113,433864,1505
                1668113,436372,901
                1668113,438175,1317
                1762762,338592,1130
                1784034,317412,1475
                1784034,362365,912
                1784034,363564,1091
                1799737,332894,1716
                1799737,335927,1787
                1849433,282564,1250
                1849433,385202,769
                1922866,209142,1587
                1922866,360502,1690
                1946388,232293,1702
                1946388,234700,607
                1946388,236738,1449
                1965800,251995,1275
                2004069,212849,1581
                2004069,292146,734
                2004069,293974,671
                2029089,188029,1403
                2029089,242226,1370
                2098389,257304,1459
                2098389,259569,597
                2117508,276301,1495
                2117508,279963,1030
                2130878,262021,1849
                2130878,292089,995
                2130878,294071,1120
                2158512,289718,1579
                2190774,322096,1657
                2190774,324762,738
                2190774,325107,1805
                2245169,376413,1379
                2245169,379548,1949
                2295932,324696,1511
                2295932,429086,648
                2384675,413481,1784
                2384675,417125,1270
                2468083,497154,1321
                2468083,499401,791
                2468083,501468,1364
                2564864,593939,1254
                2650354,507607,1806
                2650354,682064,895
                2650354,683125,1500
                2680225,537788,1158
                2680225,540955,660
                2751760,609024,1737
                2751760,611758,840
                2845055,702273,1626
                2845055,706569,1902
                2934224,612198,1790
                2934224,793814,732
                2934224,795915,770
                3014139,692341,1425
                3066914,745074,1468
                3066914,747495,869
                3066914,748635,1557
                3150894,828935,1640
                3150894,832598,1088
                3198514,780510,1681
                3198514,878995,559
                3282801,864650,1785
                3282801,869007,989
                3365275,781317,1367
                3365275,949673,624
                3365275,951481,959
                3377598,793628,1524
                3444132,860400,1241
                3444132,862606,604
                3444132,864193,1670
                3496039,912126,1382
                3496039,915368,512
                3511649,895959,1502
                3511649,930432,530
                3591790,976094,1374
                3591790,979630,800
                3670074,1054406,1150
                3670074,1056136,882
                3670074,1058614,892
                3703449,1087461,1811
                3746130,1044160,1411
                3746130,1132451,826
                3746130,1134563,840
                3813223,976898,1701
                3813223,1114968,1888
                3870892,1034760,1418
                3870892,1037249,873
                3958127,1121870,1232
                3958127,1124941,624
                4011625,1175269,1342
                4011625,1177823,890
                4011625,1179398,1376
                4086576,1099784,1232
                4153622,1166754,1262
                4153622,1168602,754
                4153622,1170188,1081
                4227106,1240175,1310
                4227106,1243443,1763
                4272635,1285804,1112
                4272635,1287461,940
                4317316,1240514,1371
                4317316,1333683,1933
                4398709,1159178,1374
                4398709,1323910,672
                4398709,1325863,1301
                4437446,1197935,1035
                4502321,1262675,1622
                4502321,1265278,594
                4502321,1266393,911
                4577656,1338082,1178
                4577656,1341010,1495
                4636975,1278147,1169
                4636975,1399699,930
                4667667,1308944,1470
                4667667,1312243,797
                4729631,1370490,1712
                4729631,1372869,525
                4729631,1374711,668
                4793069,1434196,1189
                4805575,1420983,1485
                4805575,1448934,887
                4805575,1449917,1521
                4892484,1333877,1410
                4892484,1512479,1065
                4903976,1345350,1614
                4903976,1347741,906
                4994673,1436009,1728
                4994673,1440093,1303
                5040294,1481719,1674
                5040294,1484062,647
                5040294,1486561,1122
                5125828,1395379,1612
                5180071,1341248,1313
                5180071,1451594,910
                5180071,1453939,1899
                5206046,1315187,1534
                5206046,1370946,1573
                5263177,1372580,1436
                5263177,1374254,945
                5347602,1457005,1294
                5347602,1461255,1906
                5386061,1495146,1508
                5386061,1497499,648
                5386061,1498762,1913
                5464638,1416003,1331
                5475269,1426370,1824
                5475269,1428896,640
                5475269,1430381,556
                5507333,1458641,1337
                5507333,1462434,1624
                5569851,1520853,1459
                5569851,1523445,768
                5603498,1486565,1395
                5603498,1559067,1408
                5668028,1421698,1609
                5668028,1552756,595
                5668028,1554867,664
                5714982,1374969,1649
                5784660,1444775,1403
                5784660,1447193,591
                5784660,1448378,1469
                5855529,1373009,1833
                5855529,1520010,958
                5914195,1431748,1812
                5914195,1433958,586
                5944121,1401122,1645
                5944121,1464760,1850
                6009387,1335925,1287
                6009387,1468169,792
                6009387,1469327,1440
                6032612,1312800,1051
                6059245,1339167,1577
                6059245,1341378,687
                6059245,1343165,994
                6073156,1352984,1831
                6073156,1357128,1418
                6159683,1439591,1404
                6159683,1441595,789
                6172307,1426227,1518
                6172307,1455839,724
                6248426,1502408,1331
                6248426,1504598,641
                6248426,1505879,1952
                6315344,1434941,1427
                6349575,1469084,1469
                6349575,1471134,610
                6349575,1473592,1327
                6394395,1423520,1668
                6394395,1517698,1731
                6482084,1335779,1648
                6482084,1513324,670
                6553778,1407753,1130
                6553778,1411370,1276
                6592472,1446346,1220
                6592472,1448682,698
                6592472,1450516,1025
                6666286,1519790,1529
                6721004,1464269,1652
                6721004,1576847,713
                6721004,1578078,891
                6754368,1430900,1358
                6754368,1502188,1750
                6846257,1523032,1511
                6846257,1525362,910
                6883006,1485599,1622
                6883006,1563075,504
                6962439,1406201,1498
                6962439,1566838,981
                6962439,1569320,782
                7044121,1487800,1321
                7139269,1391740,1426
                7139269,1585115,690
                7139269,1586117,651
                7156685,1409348,1605
                7156685,1412519,1229
                7250779,1503436,1418
                7250779,1505881,648
                7282038,1534670,1260
                7282038,1538678,1337
                7376693,1439351,1378
                7376693,1632005,977
                7376693,1632572,1139
                7392904,1422816,1679
                7436877,1379033,1792
                7436877,1469568,534
                7436877,1471130,1796
                7462355,1404714,1105
                7462355,1408293,1238
                7479731,1386525,1688
                7479731,1424428,568
                7516868,1423551,1897
                7516868,1427341,583
                7615136,1324309,1715
                7615136,1524088,990
                7615136,1525932,1427
                7696502,1241918,2972
            """.trimIndent()
            lowestFlaps(input)
        }
    }
}

fun main(args: Array<String>) {
    Quest19.part1()
    Quest19.part2()
    Quest19.part3()
}

