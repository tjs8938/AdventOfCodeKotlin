package year2024.day15

import AdventOfCodeKotlin.util.Adjacent
import AdventOfCodeKotlin.util.Node
import AdventOfCodeKotlin.util.Graph

fun main() {
    Day15.part1()
    Day15.part2()
    Day15.part3()
}

class Day15 {
    companion object {
        fun part1() {
            val input = """
                #####################.#####################
                #.........................................#
                ##########.#.#########.####.###############
                #.........................................#
                #.#####.##########################.######.#
                #.........................................#
                #############.#####.##.########.###########
                #.........................................#
                #####.##.########################.##.######
                #.........................................#
                #################.#.###.##.################
                #.........................................#
                #.#######################################.#
                #.#.#.#.#...#.................#.#.#...#...#
                #.#.#...#...#.................#.#.#...#.#.#
                #...#.#.#.#.#.................#.#.#.#.#.#.#
                #.#.#.#.#.#.#....###...###....#...#.#.#.#.#
                #.#.#.#.#.#.#...#####.#####...#.#.#.#.#.#.#
                #...#...#.#.#...#####.#####...#...#.#.#...#
                #.#...#...#.#....###...###......#.#.#...#.#
                #.#.#.#...#.......#.....#.....#.#.#.#...#.#
                #.#.#.#.#.#.......#.....#.....#.#...#.#.#.#
                #.#.#.#.#.#.#.................#.#.#.#.#.#.#
                #.#...#.#.#.#...H.H.H.H.H.H.....#.#.#.#.#.#
                #.#.#.#.#.#.#.................#.#...#.#.#.#
                ###########################################
            """.trimIndent().split("\n").map { it.toList() }

            val allNodes = Graph.buildGraph(input,
                ::Node, { it != '#' })

            val start = allNodes.entries.first { it.value.y == 0 }.value
            val routeTable = Adjacent.buildRouteTable(listOf(start))

            println(allNodes.values.filter { it.value == 'H' }.minOf { routeTable[start]!![it]!! } * 2)
        }

        fun part2() {
            val input = """
                ##########################################.##########################################
                #.A.#.#.#.#.#.#.#.#.#.#...#.#...#.#.#...#.....#.#.#.#.#...#.#...#...#.#.#.#.#.#.#.A.#
                #.A.#.#.....#.....#.#.#.#.....#.#.#.#.#...#.#.#...#.#.#.#.#...#...#.#.#.#.#.#.#.#.A.#
                #.A.....#.#...#.#...#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.......#.#.#...A.#
                #.A.#.#.#.#.#.#.#.#...#.#.#.#.#.#...#.#.#...#.#.#.......#...#.#.#.#.#.#.#.#...#.#.A.#
                #.A.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#...#...#.A.#
                #.A.#.#.#.#.#.#.#.#.#...#.....#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.A.#
                #.A...#.....#.#.#.#.#.#.#.#.#.#.#.#.#.....#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...A.#
                #.A.#.#.#.#.#.#.#.#...#...#.#.#.#...#.#.#.#.#.#...#...#.....#.#.#.....#.#.#.#.#.#.A.#
                #.A.#.#.#.#.#...#.#.#.#.#.#.#.#...#.#.#.#...#.#.#.#.#.#.#.#.....#.#.#.#...#.#...#.A.#
                #.A.#...#.#...#.....#.#.#.#.#...#.#...#.#.#.#.#.#.#.#...#.#.#.#.#.#.#...#.#...#.#.A.#
                #.A...#.#...#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.A.#
                #.A.#.#...#.#.#.#.#.#.#.#.....#.#.#.#.#...#.#...#.#.#.#.#.#.#.#...#...#.#...#.#...A.#
                #.A.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#...#.#.#.#.#.#.#.#.#.#.#.#.A.#
                #.A.#...#.#.#.#...#.#.#...#.#...#.#.....#.#...#.#.#.#...#...#.#.#...#...#.#...#.#.A.#
                #.A.#.#.#.#.#.#.#...#...#.#.#.#.....#.#.#...#.#.....#.#.#.#.#.#.#.#.#.#...#.#.#.#.A.#
                #.A.#.#.#.#.....#.#...#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.....#.#.#.#.#...#...#.A.#
                #################.#################################################.#################
                #...#.#.#.....#.#.#.#.#.#.#.#.#.#.B.B.B.B.B.B.B.B.B.#.#.#.#.#...#.#.#.#.#.#.#.#.#...#
                #.#.#.#.#.#.#...#.#.#.#.#.#.#.#.B.B...............B.B.#.#...#.#.#.#.#.#.#.#.#.#...#.#
                #.#.#.#.#.#.#.#.#.....#.#.#.#.B.B.....~~~~~~~~~.....B.B.#.#.#.#.#...#...#.#.#...#.#.#
                #.#.#.#.#.#.#.#.#.#.#.#.#.#.#.B....~~~~~~~~~~~~~~~....B.#.#.#.#...#...#.#.#.#.#.#.#.#
                #.#.....#.#.#.#.#.#.#.#.#.#.B.B...~~~~~~~~~~~~~~~~~...B.B.#...#.#.#.#.#.#...#.#.#.#.#
                #.#.#.#.#.#.#.....#.#.#.#...B...~~~~~~~~~~~~~~~~~~~~~...B.#.#.#.#.#.#.#.#.#...#.#.#.#
                #.#.#.#.....#.#.#...#.#.#.#.B...~~~~~~~~~~~~~~~~~~~~~...B.#.#.#.#.#.#.....#.#.#...#.#
                #.#.#.#.#.#.#.#.#.#.....#.#.B...~~~~~~~~~~~~~~~~~~~~~...B.#.#.#.#.#...#.#.#.#.#.#.#.#
                #.#...#.#.#.#.#.#.#.#.#...#.B.B...~~~~~~~~~~~~~~~~~...B.B...#.#.#.#.#.#.#.#.#...#.#.#
                #.#.#.#.#.#.#.#...#.#.#.#...#.B....~~~~~~~~~~~~~~~....B.#.#.....#.#.#.#.#.#...#.#.#.#
                #.#.#.#...#...#.#.#.#.#.#.#.#.B.B.....~~~~~~~~~.....B.B.#.#.#.#.#.#.#.#...#.#.#.#.#.#
                #.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.B.B.B...........B.B.B.#.#.#.#.#.....#.#.#.#.#.#.#.#.#
                #.#.#...#.#.#.#.#.#.#.....#.#.#.#.#.B.B.B.B.B.B.B.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#
                #.####################################.#.#.#.#.####################################.#
                #.C.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#..#.#.#.#..#.#.#.#.#.....#.#.#...#.#.#.#...#.C.#
                #.C.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.............#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.C.#
                #.C.#.#.#.#.#.#.#...#.#.#.#.#.#...#.#.#.#...#.#.#...#.#.#.#.#.#.#.#.#.#.#...#.#.#.C.#
                #.C.#.#.#.#.#.#.#.#.#.#...#.#...#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.C.#
                #.C.#.#.#.#...#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#...#...#.#.#.#.#.#.#.#.#...#.#.#...C.#
                #.C...#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.C.#
                #.C.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.......#.#.#.#...#.#...#.#.#.#.#.#.#.#.#.C.#
                #.C.#.#.#...#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.....#.#.#.#.#.#.C.#
                #.C.#...#.#.#...#.#.#.#.#.#.#.#.#...#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.C.#
                #.C.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#...#.#.#.#...#.#.#.#...#.#.#.C.#
                #.C.#.#.#.#.#.#...#.#.#.#...#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#...#.C.#
                #.C.#.#...#.#.#.#.#.#.#...#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#...#.#.C.#
                #.C.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#...#.#.....#.#.#.#.#.#.#.#.#...#.#.#...C.#
                #.C.#.#.#.#.#...#.#.#...#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.C.#
                #.C.#...#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#...#.#...#.#.#.#.#.#.#.#.#.C.#
                #.C...#.....#.#.#...#.#.#...#.#...#.#...........#.#.#.#.#...#.#...#.#...#.#.#.#.#.C.#
                #.####################################.#.#.#.#.####################################.#
                #...#.#.#.#.#.#.....#...#.#.#.#.#...#...........#...#.#.#.#.#.#...#...#.#.#.#.#.....#
                #.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#...#.#.#.#.#
                #.#.....#.#.#.#.#.#.#.#...#.#...#.#...#.#...#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#
                #.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#...#.#...#...#.#.#.#.#.....#...#.#.#.#
                #.#.#.#.#...#.#.#.#...#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#
                #.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.....#...#.#...#.#...#.#.#.#.#...#.#.#.#...#.#.#
                #.#.#.#.#.#.#...#.#.#...#...#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#...#...#.#.#.#.#.#.#.#.#
                #.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#...#.#.#.#.#.#.#.#.#.#.#.#.#
                #.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#...#.#.#.#
                #.#.#...#.#.#.#.......#...#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#
                #.#.#.#.#.#.#...#.#.#.#.#...#.#.#.#.#.#.#.#.#.....#.#.#...#.#.#.#.#.#.#.#.#.#.....#.#
                #.#...#.#.#...#.#.#.#.#.#.#.#...#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.......#.#.#.#.#
                #.#.#.#.....#.#.#.#.#.#.#.#.#.#.....#.#...#.#.#.#.#.....#.#.#.#.#...#.#.#.#.#.#.#.#.#
                #######################.#####################################.#######################
                #...#...#.#.#.#.#.#.#.#.#.#.#...#.#...............#...#...#.......#.#.#.#.#.#.#.....#
                #.#...#.#...#.#.#...#.#.#.#.#.#.#.#......###......#.#...#.#.#.#.#...#.#.#.#...#.#.#.#
                #.#.#.#.#.#.....#.#...#.#.#.#.#.#.#....#######......#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#
                #.#.#.#.#.#.#.#...#.#.#.#.#...#.#.#...#########...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#
                #.#.#.#.#.#.#.#.#.#.#.....#.#...#.#...#########...#.#.#...#.#.#...#.#.#.#.#.#.#.#.#.#
                #.#...#.#.#.#.#.#...#.#.#...#.#........#######....#.#.#.#.#...#.#.#.#.......#.#.#.#.#
                #.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#......###......#.#.#.#.#.#.#.#.#...#.#.#...#.#.#.#
                #.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.......#.......#...#.#...#.#.#...#.#.#.#.#...#.#.#
                #.#.#.#...#.#.#...#.#.#.#.#...#.#.#.......#.......#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#
                #.#.#.#.#.#.#.#.#.#.....#...#.#...........#.......#.#.#.#.#.#.#.#.#.#.#.#...#.#...#.#
                #.#.#.#.#.#.#...#.#.#.#...#.#.#.#.#.................#.#.#.#.#.#.#.#.#.....#.#.#.#.#.#
                #.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.......D.......#.#...#...#.#.#.#.#.#.#.#.#...#.#.#
                #E#.#.#...#...#.#.#.#.#.#.#.#.#.#.#...............#.#.#.#.#.#...#.#...#.#.#.#.#.#.#E#
                #####################################################################################
            """.trimIndent().split("\n").map { it.toList() }

            val allNodes = Graph.buildGraph(input,
                ::Node, { it != '#' && it != '~' })

            val start = allNodes.entries.first { it.value.y == 0 }.value
            val herbs = allNodes.values.filter { it.value in ('A'..'Z') }
            val routeTable = Adjacent.buildRouteTable(listOf(start).plus(herbs))
            var bestPath = Int.MAX_VALUE
            val collected = mutableSetOf<Char>()

            fun collect(lastPoint: Node<Char>, dist: Int, collected: MutableSet<Char>): Unit {
                if (dist >= bestPath) return

                val options = herbs.filter { it.value !in collected }

                if (options.isEmpty()) {
                    (dist + routeTable[lastPoint]!![start]!!)
                        .takeIf { it < bestPath }
                        ?.let { bestPath = it }
                } else {
                    options.forEach { herb ->
                        collected.add(herb.value)
                        collect(herb, dist + routeTable[lastPoint]!![herb]!!, collected)
                        collected.remove(herb.value)
                    }
                }
            }
            collect(start, 0, collected)
            println(bestPath)
        }

        fun part3() {
            val input = """
                ###############################################################################################################################.###############################################################################################################################
                #.A...#.....#.#.#.#.#.#...#.#...#.#...#.......#.#.#.#.#.#.#.#.#.......#.#...#.#.#.A.#..G.#.#.#.#.#.#...#.#...#.#.#.........#.#...#.#...#.#.#.....#.#...#...#.#.#.#.#...G..#.N.#.#.#.#...#.#...#.#.#.#.#.#.#.#.#.#.#...#.......#.#.#.#.#...#.#...#...#...#.#.N.#
                #.A.#...#.#.#.#.....#...#...#.#.....#.#.#.#.#.#.#.......#.#.#.#.#.#.#...#.#.#...#.A..#.G.#...#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.....#.#.#.....#.#.#.#.#.#.#.#.....#...#.#.G.#..N...#.#...#...#.#...#...#.#.#.#.#...#.#.#...#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.N.#
                #.A.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#...#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.A.#..G...#...#.....#.#...#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#...#...#.#.#.#.#...#.G..#.N.#.#...#.#.#...#.#...#.#.#.#.#.#.#...#.#.#.#.#.#.#...#.#...#.#.#.#...#.#.#...#.N.#
                #.A.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.....#.#.#.#.#.#.#.#.#.#...A..#.G.#.#.#.#.#.#.#.#.#.#.....#.#.#.#.#.#.#.#...#.#.#.#.#.#.#...#.#.#.#.#.#...#.#.#.G.#..N.#...#.#.#.#.#.#.#.#.#.........#.#.#...#.#.#.#.#.#.#.#...#.#...#.#.#.#...#.#.#.N.#
                #.A.#.#.....#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.A.#..G.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.G..#.N.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.....#.#.#.#.#.#...#.#.#.#...#.#.N.#
                #.A.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#...#.#.#.#.#.#...#...#.#...#.#.#.#.#.#.#.#.#.#.A..#.G.#...#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#...#.#.#...#.#.#.#.#.#.#.#...#...#.#.#.#.G.#..N...#.#.#.#.#.#.#...#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...N.#
                #.A.#.#.#.#.#.#.#.#.#.#.#.#.#.#.....#.#.#.#.......#.#.#.#.#.#.#.#.#.#.#.#.....#.#.A.#..G...#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#...#...#...#...#.#.#.#.#.G..#.N.#.#.#.#.#.......#.#.#.#.#.#.#.#.#.#.#.....#...#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.N.#
                #.A...#.#.#...#...#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.....#.....#.#.#.#.#.A..#.G.#.#.#...#.#.....#.#...#.#.#...#.#...#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.G.#..N.#.#.#...#.#.#.#.#.#.#.#...#...#.#.#...#.#.#.#.#.#.#.#.#.#...#.#...#.#.#.#.#.#.N.#
                #.A.#...#.#.#.#.#...#.#.#...#...#.#.#.#.#...#.#.#.#.#.#.....#.#.#.#.#.#...#.#.#.#.A.#..G.#.#.#.#.#...#.#.#.#.#.#.#.#.#...#.#...#.#.#.#.#.....#.#...#...#.#.#.#...#.#...G..#.N.#.#...#.#.#.#.#.#.#...#.#...#.#.#.#.#.#.#.#.#.#.#...#...#.#.....#.#.#.#.#.#.#.N.#
                #.A.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.....A..#.G.#.#.#.#.#.#.#.#.....#.#...#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.G.#..N.#...#.#.#.#.#.#.#...#.#.#.#.#.....#.#.#.#...#.....#.#.#...#.#.#.#...#.#.#.#...N.#
                #.A.#.#.#.#.#.#.#.#.....#.#...#.#.....#...#.#.#.#.#...#.#.#.#.#.#...#.#.#.....#.#.A.#..G.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#...#.#.#.#...#.G..#.N.#.#.#.#...#...#.#.#.#.#.#.#.#.#.#...#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.N.#
                #.A.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.....#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.A..#.G.#.#.......#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.....#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.G.#..N.#.#.#.#.#...#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#...#.N.#
                #.A.#.#.#...#.#...#.#.#.#.#.#.#.#.#.#.#.#...#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.A.#..G.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.......#.#.#...#...#...#.#.#.#.#.G..#.N...#...#.#.#.#.#...#.#.#.#.#.#.#.#.#.#...#.#...#.#...#.#.#...#.#.#.#.#.#.#.#.#.N.#
                #.A.#...#.#.....#...#.#...#.#.#.#.#.#.#.#.#...#.#.#.#...#...#.....#.#.#...#.#.#.#.A..#.G.....#.#.#...#.#...#.#.#.#...#...#.#.#...#.#.#.#.#.#.#.#...#.#.#.#.#.#...#.#.#.G.#..N.#...#...#.#.#.#.#.#...#.#...#.#...#.#.#.#.#.#.#.#.#.#...#.#.....#.#.#.#...#...N.#
                #.A...#.#.#.#.#.#.#.....#.#.......#.#.....#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.......A.#..G.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#...#.#.#...#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.....G..#.N.#.#.#.#.#.#.#...#.#.#.#...#.#...#.....#.#...#.#.#.#.#.#...#.#.#...#.#.#.#.#.#.N.#
                #.A.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#...#.#...#...#...#.#.....#.#.#.#.#.#.A..#.G.#.#.#.....#.#...#...#.....#.#.#.#.....#.#.....#.#.#...#.#.#...#.#.#...#...#.#.G.#..N.#.#.#.#...#.#.#.#...#...#.#...#.#.#.#.#.#.#.#.#...#...#.#.#.#.#.#.......#...#.N.#
                #################.#################################################.#################.################.#################################################.################.#################.#################################################.#################
                #...#.#.#.#.#...#...#...#.#.#.#.#.B.B.B.B.B.B.B.B.B.#.#.#.#.#.#...#.#...#.#...#.#....#.....#.#.#.#.#.#.#.#.#.#...#.#.#.H.H.H.H.H.H.H.H.H.#.#.#...#...#.#.#.#.#.#.#...#...#....#.#...#.#.#.#.#.#.......#.#.#.O.O.O.O.O.O.O.O.O.#.#.#...#.#...#...#.#.#...#.#...#
                #.#.#.#...#.#.#.#.#.#.#.#.#.#.#.B.B...............B.B.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.H.H...............H.H.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#..#.#...#.#.#.#.#.#.#...#.#.#.#.#.O.O...............O.O.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#
                #.#.#.#.#.#.#.#.#.#.#.#.#.#.#.B.B.....~~~~~~~~~.....B.B.#.#.#.#.#.#.#.#.#...#...#.#..#.#.#.#.#.#...#...#.#.#.#.#.#.H.H.....~~~~~~~~~.....H.H.#.#.#.#.#.#.......#.#.#...#.#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.O.O.....~~~~~~~~~.....O.O.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#
                #.#.#.#.#...#.#.#.#.#.#...#.#.B....~~~~~~~~~~~~~~~....B.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#..#.#.#.#...#.#.#.#.....#.#.#.H....~~~~~~~~~~~~~~~....H.#.#...#.#.#.#.#.#.....#.#.#..#.#.#.#.#.#...#.#.#.#.#.#.#.#.O....~~~~~~~~~~~~~~~....O.#.#.#...#.#.#.#.#.#.#.#...#.#
                #.#...#.#.#...#...#...#.#.#.B.B...~~~~~~~~~~~~~~~~~...B.B.#.#.#.#.#.#.#...#.#.#...#..#.#.#.#...#.#...#.#.#.#.#.#.H.H...~~~~~~~~~~~~~~~~~...H.H.#.#.#.#...#.#.#.#.#.#.#.#.#..#.#.#.#.#.#.#.....#.#.#.#.O.O...~~~~~~~~~~~~~~~~~...O.O.#.#.#.#...#.#.#...#.#.#.#.#
                #.#.#.....#.#.#.#.#.#.#.#.#.B...~~~~~~~~~~~~~~~~~~~~~...B.#.#...#.#...#.#.#.#.#.#.#.#..#.#...#.#.#.#.#.#.#.#...#.H...~~~~~~~~~~~~~~~~~~~~~...H...#.#.#.#.#.#.#.#.#.#.#.#..#.#.#...#...#...#.#...#.#.#.O...~~~~~~~~~~~~~~~~~~~~~...O.#.#.#.#.#.#.#...#.#.#.#.#.#
                #.#.#.#.#.#.#...#.#.#.#.#.#.B...~~~~~~~~~~~~~~~~~~~~~...B...#.#.....#...#.#.#.#.#.#..#.#.#.#.#.#.#.#.#.#.#.#.#...H...~~~~~~~~~~~~~~~~~~~~~...H.#.#.#.#.#.#.#...#.#.#.#.#.#..#...#.#.#.#.#.#.#.#.#...#.O...~~~~~~~~~~~~~~~~~~~~~...O.#.#.#...#.#...#.#.#.#.#.#.#
                #.#.#.#.#.#.#.#.#.#.#...#...B...~~~~~~~~~~~~~~~~~~~~~...B.#...#.#.#.#.#.#.#.#.#.#.#.#..#.#.#.#...#.#.#...#.#.#.#.H...~~~~~~~~~~~~~~~~~~~~~...H.#...#...#...#.#.#.#.#.#.#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.O...~~~~~~~~~~~~~~~~~~~~~...O.#...#.#.#.#.#.#.#...#.#.#.#
                #.#.#.#.#...#.#.....#.#.#.#.B.B...~~~~~~~~~~~~~~~~~...B.B.#.#.#.#.#.#.#.#.#.#.#.#.#..#.#.#.#.#.#.#.#...#.#.#.#.#.H.H...~~~~~~~~~~~~~~~~~...H.H.#.#.#.#.#.#.#.#.#.#.#.#.#.#..#.#.#...#.#.#.#.#.#.#.#.#.O.O...~~~~~~~~~~~~~~~~~...O.O.#.#...#...#.#.#.#.#...#.#.#
                #.#.#.#.#.#.#.#.#.#.#.#...#.#.B....~~~~~~~~~~~~~~~....B.#.#.#...#.#.#.#.#.......#.#.#..#.#.#...#.....#.#.#.#.#.#.#.H....~~~~~~~~~~~~~~~....H.#.#.#.#.#.#.#.#.#...#...#.#..#.#.#...#.#...#.#.#.#.#.#.#.#.O....~~~~~~~~~~~~~~~....O.#...#.#.#.#...#.#.#.#.#...#.#
                #.#.....#.#.#.#.#.#.#.#.#.#.#.B.B.....~~~~~~~~~.....B.B.#.#.#.#.#...#.#...#.#.#.#.#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.H.H.....~~~~~~~~~.....H.H.#.#.#...#.#.#.#.#.#.#.#.#.#.#..#.#.#.#.#.#.#.#...#...#.#.#.O.O.....~~~~~~~~~.....O.O.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#
                #.#.#.#.#.#...#.#.#...#.#...#.#.B.B.B...........B.B.B.#.#.#...#.#.#.#.#.#.#.#.#...#.#..#.#.#.#.#.#.#.#.#.#.#...#.#.#.H.H.H...........H.H.H.#.#.#.#.#...#.#...#.#...#.#.#..#.#.#.#.#.#.#...#.#.#.#.#...#.#.O.O.O...........O.O.O.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#
                #.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.B.B.B.B.B.B.B.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#..#.#.....#.#.#.#.#.......#.#.#.#.#.#.H.H.H.H.H.H.H.#.#.#.#.#.#.#.#...#.#.#.#.#.#...#.#..#.#.#.#...#.#...#.#.#.#.#.#.#.#.#.O.O.O.O.O.O.O.#.#.#.#.#.#.#.#.#.#...#...#...#.#.#
                #.####################################.#.#.#.#.####################################.#..####################################.#.#.#.#.####################################..#.####################################.#.#.#.#.####################################.#
                #.C...#...#.#.#.#.#.#.#.#.#.#.#.#...#..#.#.#.#..#.#...#...#.#...#.#...#...#.#.#.#.C..#.I.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#....#.#.#.#..#.#.#...#...#...#.#.#.#.#.#...#.#.I.#..P.#.#.#.#.....#.#.#.#.#.....#.#.#.#..#.#.#.#..#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.P.#
                #.C.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#...........#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.C.#..I.#.#.#.#...#.#.#.#...#.#.#.#.#...#.............#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.I..#.P...#.#...#.#.#.#.#.....#.#.#...#.#...........#.#.#.#.#.....#.#.#...#.#.#.#...#.P.#
                #.C.#...#.#.....#.#.#.#.#...#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#...#.C..#.I.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#...#.#.#.#.#...#.#...#.#.#.I.#..P.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.....#.#.#.#.#.#.#.#.#.#.#.#.P.#
                #.C.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.C.#..I.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#...#.#...#.#.#.#.I..#.P.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.P.#
                #.C.#.#.#...#.#.#.#.#...#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.....#.#.#.#.#.#.#.#.#.C..#.I.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#...#.#.#...#.....#.#.#.#.#.#.#.#.I.#..P.#.#.#.#.......#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.....#.#.#.#.P.#
                #.C.#.#.#.#.#.#.#.#.#.#...#.#.#...#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#...#.#.#.C.#..I.#.#.#.#.#.#.....#.#.#.#.#.#.......#.#.#.#.#.#.#.#.#.#.#...#.#.#.#...#.#.#.#.#.I..#.P.#.#.#.#.#.#.#.#.#.#...#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#...#.#.#.P.#
                #.C.#.#.#.#.#.#...#.#.#.#.#...#.#.#.#.#.#.#.#.#.....#.#...#.#.#.#...#.#.#.#.#.....C..#.I.#.#...#.#...#.#.#...#.#.#.#.#.#.#.#.#.#.....#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.I.#..P.#.#.....#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.P.#
                #.C.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#...#.#.#.#...#.#.#.#.#.#.#.#.C.#..I.#...#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.I..#.P.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#...#.#.#.#.#.#.#...P.#
                #.C.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#...#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.C..#.I.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.....I.#..P.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#...#.#.#.#.#.#...#.#.#.#.#.#.P.#
                #.C.#.....#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.C.#..I...#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#...#.#.#.#...#...#.#...#.#.#.#.#.#.#.#.#.#.I..#.P.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.....#...#.#.#.#...#.#.#.#...#.#.#.#.#.#.#...#.P.#
                #.C.#.#.#.#.#...#.#.....#.#.#...#.#.#.#.#.#...#.#.#.#.#.#.#...#.#.#...#.#.#.#.#.#.C..#.I.#.#.#...#.#.#...#.#.#...#...#.#.#.#.#.#.#.#.#.#.#.#...#.#.#...#.#.#.#.#.#.#.#.I.#..P.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#...#.#.#.#.#.P.#
                #.C.#.#.#.#...#.#.#.#.#...#...#.#.#.#...#.#.#.#.#.....#.#...#.#.#.#.#.#.#.#...#.#.C.#..I.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.....#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.I..#.P.#.#.#.#.#.#.#.#.....#.#...#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#...#.#.#...P.#
                #.C.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.C..#.I.#.#.#.#...#.#.#...#...#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.....#.#.#.#.#.#.I.#..P.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#...#.#.#.#.#.#...#.#...#.#.#.#.#.#.#.P.#
                #.C.#.#.#.#.#.#...#.#.#.#.#.#.#...#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.C.#..I.......#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...I..#.P.....#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.......#.#.#.#.#...#.#.#.#.#.#.#.#.#...#.#.P.#
                #.C.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#...#.#.#.#...#.#.#.#.#.#.#.#.C..#.I.#.#.#.#.#.....#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#...#.I.#..P.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.P.#
                #.C...#.#.#.#.#.#...#.#.#.#.#.#.#.#.#...........#.#.#.#.#.#.#.#.#...#...#.#.#.#...C.#..I.#.#.#.#.#.#.#.#.#.#.#.#.....#.#.#.............#.#.#.#.#.#.#.#.#.#.#.#.....#.#.I..#.P.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.................#.#.#.#.#.#.#.#.#.#.#...#.#.#.P.#
                #.####################################.#.#.#.#.####################################..#.####################################.#.#.#.#.####################################.#..####################################.#.#.#.#.####################################.#
                #.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#...........#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#..#.#.#.#.#.#.#.....#.#.#.#...#.#.#.#...............#.....#.#.#.#.#.#.#.#.#.#...#.#..#.#.#.#...#...#.#.#...#.#.#...#...#.#...........#.#.#.#...#.#.#.#...#.#.#.#.#.#.#.#.#
                #.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#...#.#.#.....#.#.#.#.#.#.#.#.#.#.#.....#.#.#.#..#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.....#.#.#.....#.#.#.#.#.#..#.#...#...#.#...#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#
                #.#.........#.#.#...#.#.#.#.#.#.#...#.#.#.....#.#.#.#.....#.#.#.#.#.#.#.#.#...#.#.#.#..#.#.#...#.#.#.#.#.#...#...#.#.#.....#...#...#.#.#...#.#.#.#.#...#.#.#.#.#.#.#.#.#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#
                #.#.#.#.#.#.....#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.....#.#.#.#.#.#.#..#.#.#.#.#.#.#...#.#.#.#...#.#.....#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#..#.#.#.#.#.#.#.#.#.#.....#.#.#.#.#.....#.#.#...#.#...#.#.#...#.#.#.#...#.#.#.....#.#
                #.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#..#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#...#.#.#...#.#.#...#.#.#.#..#.#...#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#...#...#.#.#.#...#.#.#.#.#.#
                #.#.#.#.#.#.#.#.#.#.....#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#...#.#.....#.#.#.#.#..#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#..#.#.#.#...#.#...#.#.#.#.#.#.....#.#.#.#.#.#.#.....#.#.#.#.#.#...#...#.#.#.#.#.#.#.#
                #...#.#...#.#.#.#.#.#.#.#.#.....#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.......#....#.....#.#.#.#.#.#.#.#.#...#.#...#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#....#...#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#...#...#.#.#.#.#...#.#.#.#...#.#.#.#...#.#...#
                #.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.....#.#.#.#.#.#...#.#.#.#.#.#.#..#.#...#.#.#.......#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#...#.#.#...#.#.....#.#.#...#.#.#..#.#...#.#.#.#.#.#...#.#...#.#.#.#.#...#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#
                #.#.#...#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#...#.#.#.#...#.#.#.#..#.#.#.#.#.#.#.#.#...#.#...#.#.#.#...#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#...#.#.#..#.#.#.#.#.#.#.#.#.#.#...#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#...#.#
                #.#.#.#.#.#.#...#...#.#.#.#.#.#.#.#.#...#...#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#..#.#.#.#.#.#...#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#...#.#.#
                #.#...#.#.#.#.#.#.#.#.#...#.....#.#.#.#...#.#.#...#.#.#...#...#.#.#.#...#...#...#.#.#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#...#.#.#.#.#.....#.#.#...#.#.#.#..#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#...#...#.#.#.#.#.#...#.#.......#.#.#.#...#.#.#.#.#
                #.#.#.#.#...#.#.#.#.#.#.#.#.#.#...#...#.#.#.#...#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#..#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#...#.#.#...#.#..#...#.#.#.#.#.#...#.#.#...#.#.#...#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#...#.#.#.#.#.#.#
                #.#.#.#.#.#...#.#.#.....#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#...#...#.#.#.#.#.#.#.#...#.#..#.#...#.....#.#.#.....#.#.#.#...#.#.....#...#.#.#.#.#.#.#...#.#.#...#.#.#...#.#.#..#.#.#.#...#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.....#.....#.#.#.#.#.#.#.#...#.#.#...#.#.#.#
                #######################.#####################################.######################.#######################.#####################################.#######################.######################.#####################################.#######################
                #...#.#...#.#.#.#.#.#.#.#.#.....#.#...............#.#...#.#.#.#.#.#.#.#...#...#.#...#....#.#.#.#.....#.#...#.#.#.#.#.#.#...............#.#.#.#.#.#.#.#.#.#.#.#.#.#.#......#.....#.....#.#.#...#.#.#.#.#.#.#.#...............#.#.#.#...#...#.#.#.....#.#.#.#...#
                #.#.#.#.#.........#.#.#.#.#.#.#.#.#......###..........#...#.#.#.#...#.#.#.#.#.#...#..#.#.#...#.#.#.#.#.#.#.#...#.#...#.#......###......#.#.#.#...#.#.#.#.#.#.#.#...#.#.#.#..#.#.#.#.#...#.#.#.#.#.#.#.#.#.#........###......#.#.#.#.#.#.#.#...#.#.#...#.#.#.#.#
                #.#.#...#.#.#.#.#.#.#.#.#.#.#.#...#....#######....#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#..#.#.#...#.#.#...#.#.#.#.#...#...#....#######....#.#.#...#.#.#.#.#.#.#...#.#.#.#.#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.....#....#######....#.#.#...#.#.#...#...#.#.#.#.#.#.#.#
                #.#.#.#.#.#.#.#.#.#.#.#.....#.#.#.....#########...#.#.#.#.#.#.#...#.#.#.#...#.#.#.#..#.#.#.#.#.#.#.#.#...#...#.#.#.#.#.#...#########...#.#...#.#.#.......#.#.#.#.#.#.#.#.#..#.#.#.#.#.#...#.#...#.#.#...#.#.#...#########.....#.#.#.#.#.#.#.#.#.#.#.#.#...#.#.#
                #.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#########...#.#...#.#.#...#.#.....#.#.#.#.#.#.#..#...#.#.#.#.#.#.#...#.#.#.#.#.#.#...#########...#.#.#.#.#.#.#.#.#...#.#...#...#.#..#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#...#########...#.....#.#.#.#.#.#.#.#.#.#.#.#...#.#
                #.#.#.#.#.#.#.#...#...#.#.#...#.#.#....#######....#.#.#.#...#.#.#.#.#.#.#.#.#.....#..#.#.#.#.#...#...#.#.#.#.....#.#.#......#######....#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#..#.#...#...#.#.#.#.#.#...#.#.#.#.#....#######....#.#.#.#.#...#.#.#.#.#.#.#...#.#.#.#
                #.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#......###......#.#.#...#.#.#.#.#.#.#...#.#.#.#.#.#..#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.#......###......#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#..#.#...#.#.#.#.#.#...#.#.#...#...#.#......###......#.#.#.#.#.#.#.#.#.....#...#.#.#.#.#
                #.#.#.#.#.#.#.#.#...#.#...#.#.#.#.#.......#.......#.#.#.#.#...#.#.#.#.#.#...#.#.#.#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#...#.......#...........#...#...#.#.#.#...#.#.#.#.#.#.#..#.#.#.#.#.#.#...#.#.#.#.#...#.#.#.......#.......#.#.#.....#.#...#.#.#.#.#.#.#.#.#.#
                #.#.#.#.#.#...#.#.#.#.#.#...#...#.#.......#.......#.#.#.#.#.#...#.#...#.#.#.#.#.#.#.#..#...#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.......#.......#.#.#.#.#.#...#.#.#.#.#...#.#.#.#..#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.......#.......#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#
                #.#.....#.#.#.#.#.#.#.#.#.#.#.#.#.#.......#.......#...#.#.#.#.#...#.#.#.#.#.#.#.#.#..#.#.#...#.#.#.#...#.#...#...#.#.#.#.......#.......#.#...#.#.#.#...#...#...#.#.#.#.#.#..#.#.#.#.#...#.#.#...#...#.#.#.#.#.......#.......#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#
                #.#.#.#.#...#...#.#.#.#.#.#.#.#...#.................#.#.#.#.#.#.#.#.#.#.#.#...#.#.#.#..#.#.#.#.#...#.#...#.#.#.#.#.#.#.#...............#.#.#.#.#.#.#.#...#.#.#.#.....#.#..#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#...............#.#.#.#.#...#.#.#.#.#.#.#...#...#.#
                #.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#.........D.......#.#.#.#.....#.#.#.#.#.#.#.#...#.#..#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.......J...........#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#..#.#.#...#.#.#...#.#...#.#.#.#...#.......Q.......#.....#.#.#.#.#.#.#.#.#.#.#.#.#.#.#
                #E#.#.#...#.#.#.#...#...#.#.#.#.#.#...............#.#.#.#.#.#.#.#...#...#.#.#.#.#.#E..K#.#.#...#.#.#.#.#.#.#.#.#...#.#.................#.#.#.#.#...#.#.#.#...#.#.#.#.#.#K..R#.#.#.#.#.#...#.#.#.#.#...#.#.#...................#.#.#.#.#.#.#.#.#.#...#.#...#.#R#
                ###############################################################################################################################################################################################################################################################
            """.trimIndent().split("\n").map { it.toList() }

            val allNodes = Graph.buildGraph(input,
                ::Node, { it != '#' && it != '~' })

            val start = allNodes.entries.first { it.value.y == 0 }.value
            val eee = allNodes[75 to 83]!!
            val arr = allNodes[75 to 171]!!

            val orders = listOf(
                start to listOf('G', 'H', 'I', 'K', 'E', 'J', 'R'),
                eee to listOf('D', 'C', 'B', 'A'),
                arr to listOf('Q', 'P', 'O', 'N')
            )

            val result = orders.sumOf { (start, order) ->
                val herbs = allNodes.values.filter { it.value in order }.sortedBy { order.indexOf(it.value) }
                val routeTable = Adjacent.buildRouteTable(listOf(start).plus(herbs))

                var bestPath = Int.MAX_VALUE
                val collected = mutableSetOf<Char>()

                fun collect(lastPoint: Node<Char>, dist: Int, collected: MutableSet<Char>) {
                    if (dist + routeTable[lastPoint]!![start]!! >= bestPath) return

                    val options = herbs.filter { it.value !in collected }

                    if (options.isEmpty()) {
                        (dist + routeTable[lastPoint]!![start]!!)
                            .takeIf { it < bestPath }
                            ?.let { bestPath = it }
                    } else {
                        options.forEach { herb ->
                            collected.add(herb.value)
                            collect(herb, dist + routeTable[lastPoint]!![herb]!!, collected)
                            collected.remove(herb.value)
                        }
                    }
                }
                collect(start, 0, collected)
                bestPath
            }
            println(result)
        }
    }
}