package AdventOfCodeKotlin.puzzles.EverybodyCodes2024.day18

import AdventOfCodeKotlin.util.Adjacent.Companion.buildRouteTable
import AdventOfCodeKotlin.util.Node
import AdventOfCodeKotlin.util.Graph.Companion.buildGraph

fun main() {
    Day18.part1()
    Day18.part2()
    Day18.part3()
}

class Day18
{
    companion object {
        fun part1() {
            val input = """
                ###############################
                ...P#P..........#P............#
                #.#######.#####.#####.#######.#
                #.....#...#P..#...#...#....P#.#
                #####.#.#####.###.#.###.#####.#
                #.....#.....#...#...#.......#.#
                #.#########.###.#####.#####.#.#
                #...#P....#...#.#...#.....#.#.#
                ###.###.#.###.#.#.#.#####.#.#.#
                #P......#.....#...#.......#...#
                ###############################
            """.trimIndent().split("\n").map { it.toList() }

            val palms = mutableListOf<Node<Char>>()
            val graph = buildGraph(input, { x, y, c -> Node(x, y, c) }, { it != '#' }, mapOf('P' to { _, n -> palms.add(n) }))
            val start = graph.filterKeys { it.first == 0 || it.second == 0 }.values.first()
            val routes = buildRouteTable(listOf(start))

            println(palms.maxOf { routes[start]!![it]!! })

        }

        fun part2() {
            val input = """
                #########################################################################################################################################################################################################
                ....P..P#.....#...#....P..#P....#P..#..P....P...#..P#...P......P..#....P#.............#P....#......P..#....P.P..#P.P....#......P..#P....#....P#..P....#P.PP.......#P....#....P#..PP...#....P.....P#.....#
                #.#####.#.#.###.#.#.#.###.#.#.###.#.#.###.#####.#.###.#######.###.#.###.#.#######.#####.###.#.#.#####.#.#######.#######.#.###.###.###.#.###.#.#.###.#.#######.###.#####.#.#.#.#.#####.#.#.#######.#.#.###
                #..P#P..#.#.#...#P..#.#...#.#P#...#...#P#...#P....#..P#..P.P.P#...#...#P..#..P..#.#..P.P#P#..P#P#..P#.#...#PP.#P#.....#...#P..#P#..P.P#..P..#P#P.P#.#....P#..P#P#.....#.#.#.#.#.....#...#.....#P#.#P#...#
                #.###.#####.#.#######.#.###.###.#######.###.#.#####.###.#########.#.#.###.#.###.###.#####.#####.#.#.#.###.#.#.#.#.###.#####.###.#############.#####.#####.#.###.#####.#.#.#.#######.#####.###.#.#.#####.#
                #.#P.P#P..#.#.#.......#.#.....#.#P........#.#P#....P#.#P#..P#..P#.#.#.#...#.#...#..P#...#...#...#.#.#..P#P#.#.#...#......P..#P.......P#P...P#P#P.P#..P#.#P..#...#..P..#..P#P..#.....#P..#..P#P#P#...#...#
                #.#.###.#.#.#P#.#######.#.###.#P#.#.#####.#P#.#.#####.#.#.#.#.#.#.###.#####.#.#.#.#####.#.#.#.#.#.#.###.#.#.#.#.#############.#######.###.###.#.#.###.#.#####.###.#####.#####.#.#####.#.#####.#.###.#.#.#
                #P#...#.#...#.#P#P#.....#...#P#.#P#P.P..#.#.#.#...#P..#...#.#.#.#...#.......#P#.#.....#...#P#.#P#.#.#P....#.#.#P#P.P.P.P#P....#...#P..#...#...#.#.....#....P..#...#..P..#...#....P#P.P#......P#..P#.#.#.#
                #.###.#.#####P#.#.#.#####.###.#.#######.#.#.#.###.###.#####.#.#.###.#.#######.#######.#####.#.###.#.#########.#.#.#####.#####.#.#.###.#.#.#.###.#######.#.###.#.###.#####.#.#######.###########.#.#.#.#.#
                #..P#.#....P#.#.#..P#PP...#...#...#.....#.#P#.#.#...#.....#P.P#..P#.#.......#....P.P#P#..P#.#.#...#P....#.....#.#.#...#..P#...#.#..P#P..#.#....P#..PP...#P..#.#.#..P#P....#P..#...#...#.....#P..#P#...#P#
                #.#.#.#.###.#P#.#.#########.#####.#.#####.#.#.#.###.#.###.#######.#.###########.#####.#.#.#.#.#.#######.#.#.###.#.#.#.###.#.###.###.#####.#######.#########.#.#.#####.#######.#.#.#.#.#.###.###.#.#####.#
                #P#.#.#.PP#P#.#.#.....PP.P#..PP...#P#.....#.#.#...#.#..P#..P..P.#P#P.....P....#...P...#.#...#........P#.#P#.....#..P#..P#.#...#.#...#P....#....P#.#.......#P#.#...P..P#...PP#...#.#.#.#.#.#..P#P#....P#.#
                ###.#.#####.#.#.#########.#.#######.#####.#.#.###.#.#####.#######.###########.#.#######.#.###########.#P#############.###.###.#.#.#####.#####.###.###.###.#.###########.#########.#P#P#.#.###.#####.###.#
                #...#.....#...#....P#.....#...P.....#...#P#.#..P.P#.....#P#P..#...#..P.....P#.#.........#P#.....#....P#P....P.......#P#P..#...#.#.....#P#..P#..P#...#P#...#P......#..P#...P..P#...#.#P#.#...#.#..P#....P#
                #.#######.#.#######.#.###########.###.#.###.###########.#.#.#.#.###.###.###.#.#########.###.###.###.#####.#####.#####.#.###.###.#####.#.#.#.###.###.###.#.###.###.#.#.#.#####.#.#####.#P#.#.#.#.#.#.#####
                #...#....P#.......#.#...#...#P....#...#.....#..P....#..P#P#P#P..#P#P#...#P..#......P#P..#...#.....#.#P.P#....P#.#..P.P#P#....P#P#P.P#P#...#......P#...#.#.#P.P#...#P#P#.#P#P.P#P#.....#.#.#.#..P#.#.#..P#
                #.#.#.#####.#######.###.#.#.#.#####.#######.#.#####.#.###.#.#####.#.#.#############.#.###.#######.###.#.###.###.#.#####.#.###.#.#.#.#.#.#############.#.#P#.###.###.#.#.#.#.###P#.###.#.###.#####P#.#.#.#
                #.#.#..P..#P#.....#...#P#P#.#.#P..#P....#...#.#.#..P#.....#.....#..P#P.P..#P..#.....#P.P#......P#.....#.#...#...#.#...#.#P..#P#.#P#..P#P#P.........P#...#P#..P#.#..P#.#...#...#.#..P#.#P........#.#...#.#
                #.#.#####.###.###.###.#.###.#.###.#####.###.#P#.#.#######.#####.#.#######.#.#.#.#######.#####.#.#######.#.###.###.#.#.#.#####.#.#.#######.#######.#####.#####.#.#.###.#####.#.#.###.###########.#.#####.#
                #.#......P#...#......P#...#.#...#..P..#P..#P#.#.#..P...P#.#..P#.#P.P.P..#...#.#P.P#...#P#P..#.#.#...#P..#.#P#.......#.#.....#.#.#.....#..P#P..PP#...#P..#..P..#...#P#.#...#.#.#...#.#......P....#.#P..#.#
                #.#########.#############.#.###.#.###.###.###.#.#######.#.#.#.#P#######.#####.###.#.#.###.#.###.#.#.#.###.#.###############.#.#.#####.#.###.#####.#.#.###.#########.#.#.#.###.###.#.#.###########.#.#.#P#
                #P..#.....#.....#....P....#.....#.#.....#....P#...#P..#...#P#.#.#..P...P#...#.....#P#.#..P#.#..P#P#.#...#.....#..PP.PP.....P#....P..#.#.#P.P#...#P#...#P#P#..P.P.P...P#.#...#P..#.#...#P.P#.#....P#P#.#.#
                ###.###.#.#.###.###.#######.#####.#.#############.#.#.#####.#P#.#.#######.#.#.#####.#.#.###.#.#####.###.#.#####.#############.#######.#P#.###.#.#.#####.#.#.###########.###.###.#P#.###.#.#.#.#####.###.#
                #...#..P#.#.#P#...#P.P.P#P...P#P..#....P#P...P..#...#...#P..#.#.#..P#.....#.#P....#.#.#.#.#P..#P.....P#P#P#..P#P..#P....#.#...#.#.....#P#.#..P#.#...P...#P#...#P...P#P...P#...#.#.#.....#P..#.#P....#P..#
                #.###.###.#.#.###.#####.#####.#########.#.#.###.#####.#.###.#.#.#####.#####.#####.#.#P#.#.#####.#####.#.#P#.#.###.#.###.#.#.###.#.###.#.#.#.###.#########.###.###.#.#####.###.#.#.#########.#.#####.#.###
                #.....#P..#P..#P#.#...#P....#P#....P..#P..#...#.....PP#...#P#.#...#...#...#...#.#...#.#.#....P..#P...P#.#P#.#P..#.#.#..P#..P#...#.#..P#...#.#.........P...#P#P..#.#.#P....#P#...#...#..P#P..#P#....P#.#.#
                #######.#####.#.#P#.#.#####.#.#.#####.#######.###########.#.#.###.#.###.#.###.#.#####.#.#.#####.#######.###.###.#.#.#.###.###.#.#.#.#####.#.###############.###.#.#.#.#####.###.###.#.#.###.#.#.#####.#.#
                #..P#...#.......#P#P#.....#P#P#P#P....#.....#.........#P#.#.#...#...#P..#.#P..#......P#.#...#P#..P#P....#...#...#.#.#...#.....#.#.#P#P..#.#.....#P...P......#.#...#..P#PP.....#.#P#..P#...#.#.#.........#
                #.#.#.###########.###.#.#.#.#P#.#####.#.###.#####.###.#.#.#####.#########.#.###.#######.###.#.###.#.#####.###.###.#.###.#######.#.###.#.#.#####.###.#######.#.###############.#.#.#######.#P#.###########
                #.#.#...#...#...#...#.#.#.#.#.#..P..#...#.#..P..#...#.#...#P..#...........#...#....P#...#.....#P..#...P..P#P.P#P#.....#.#P.P.P#.#.#...#.#P.P#.#...#.....#.#....P#....P#....P..#.....#P..#.#P#..P#P.P.P..#
                #.#.###.#.#.#.#.###.#.#.#.#P#.#####.#####.#####.###.#.###.#.#.#.###.#####.###.#####.#.###.#####.#.#########.###.#.#####.#.###.#.#.#.###.###.#.###.###.#.#.#.#####.#.#.#.###########.#.#.#.#####.#.#####.#
                #P#.#P.P#.#P..#P#...#P#P#P#.#P...P..#.#.....P...#.#P#..P#.#.#P#...#...#P#P#P#.#P..#P.P#.#..P#...#.#..P..#...#.....#..P..#..P#P#.#...#...#P#P..#.#...#.#.#P..#.....#P#P#P#..P...P#.....#P#...#...#.#...#P#
                #.#.#.###.#####.#.#####.###.###.#####.#.#########.#.###.#P#.#.#######.#.#.#.#.###.#####.#.###.#.###.###.#.#######.#.#########.#.#####.#.#.###.#.###.#P#.#####.#####.#.#.#.###.###.#########.#.###.#.###.#
                #.#...#...#....P#.#P.P#..P#...#P#...#...#..P#..P....#..P#.#.#...P..P#P#...#.#..P#.....#..P#...#.#....P#.#..P.P..#P#...#P..P...#..P.P#.#...#P#..P#...#.#P..P...#...#P#.#.#.#.#......P#..P..#.#P#...#.#P..#
                #.#####.#.###.###.#.#.###.###.###.#.###.#.#.#########.###.#.#######.#.#.###.###.###.#.#.###.#####.#####.#######.###.#.#.#######.#####.###.#P#.###.###.#########.#.#.#.#.#.#.#########.###.#.#.#.###.#.#.#
                #...#P..#...#.#P..#P#...#...#..P..#..P#P..#P.PP...#...#.....#..P....#.#..P...P#P..#P#.#...#.#P.....P#...#..P..#..P#.#.#....P..#.#P....#.#P#.#.#...#......P#...#.#.#.#...#.....#P#....P#.#...#.......#.#P#
                ###.#######.#.###.#.###.#.###########.###########.#.#######.#######.#.#######.###.###.###.#.#.#######.#P#.###.###.#.#.#####.#.#.#.#####.#.#.#.#.#########.#.#.###.#P###.#####.#.#.#####.#####.#######.###
                #P#P#.......#....P#P.P#.#...#.......#.#P.P#P....#.#.#P..#P..#.....#.#P#..P..#P#P#P..#...#P#P..#......P#.#P..#...#.#.#....P#P#...#.....#P...P#.#.....#P..#P.P#...#.#P#.......#...#.#.......#P....#...#...#
                #.#.#.###############.#.###.#.###.###.#P###.#.#.#.#P#.#.#####.###.#.#.#.#####.#.###.#.###.#####.#######.###.###.#.#####.#.#########.#.#######.#####.#.#########.#.#.###########.#.#.#.###.#####.#.#.#.#.#
                #.#P#.#.......P....P..#..P#.#.#...#...#.#..P#P#.#.#.#.#..P......#P#P.P#.......#...#P#...P.#.#...#...#P..#...#.#...#P..#.#..P..#P..#.#...#...#...#P#.#..P......#PP.#......P.PP..P#.#.#...#.....#.#.#.#P#P#
                #.#.#.#.#.###############.#.#.#.#.#.###.#.###.###.#.#.#########.#.#####.#######.#.#P#.#####.#.#.#.#.#####.###.#####.#.###.###.#.#.#.###.#.#.###.#.#.#########.###.#####.#########.###.#.#####.###.#.###.#
                #.#...#.#P#..P#...#.....#P#P..#.#.#..P#...#P#.#...#...#.#P....#.#P#...#...#...#P#.#.#P.P....#.#.#P#...P...#...#.....#..P#P#...#.#.#P..#P#P#..P#P#.#..P.P.P..#...#.#...#...PP#...#...#.#P.P..#.....#...#.#
                #P#####.###.#.#.#.#.###.#.###.#.#.###.#.###.#.#.#####.#.#.###.#.#.###.###.#.#.###.#.#####.###.###.###########.#.###.###.###.#.#.#.#####P#.#.#.#P#.#########.#.###.#.#.#.#####.#.###.#######.#########.#.#
                #.#........P#..P#.#.#P..#P.P#P#.#.#P#.#.....#.#P...P#.#.#.#.#.#P#.#....P#P..#P....#P#.....#P..#...#..P......#P...P#.#.#..P#.#P#.#P#...#P#.#P#.#.#....P#P..#.#..P.P#.#.#.#P...P#P....#.....#.....#.....#P#
                #.#.#############.#.#.#.###.###P#P#.#.#####.#.#####.#.#.#P#.#.###.#.#############.#P#.#####.#.#.###.#######.###.###.#.###.#.###.#.#.#.#P#.#.###.###.#.#.#.#.#.#####.#.#.#.###########.###.#.###.#.#####.#
                #P#...#...P.....#P#.#.#..P#..P#.#P#.#.#P.P#.#.#P.P..#...#.#....P..#...#...........#.#.#.....#P#P#...#.....#...#.#...#.....#..P..#...#.#.#.#....P#P..#...#.#.#.#P....#.#.#.#P.......P.P#.#.#P#..P#.#..P..#
                #.###.###.#####.#.###.#######.#.#.#.#P#.###.#P#.#########.#.#######.#.#.###########P#.#.#.#####.#.#.#.#.#####.###.###.#####.#########.#.#.#######.#######.#.###.#####.###.###.#########.#.#.#.###.#####.#
                #...#...#.#P#...#...#P..P...#...#.#.#.#.....#.#.#.........#.#.#P..#.#.......#P....#.#.#.#.#P..#.#.#.#.#.....#.....#.#.#..P....#....P..#.#.#P...P..#.......#..P#.#P..#.#...#..P#...#P..#...#.#P..#...PP..#
                ###.###.#.#.#.#####.#######.#####P#.#.#####.#.#.#####.#####.#.#.#.###.#####.###.#.#.###.###.#.#.#.#.#####.#########.#.#######.#.#######.#.###.###.#.#########.#.###.#.#.###.###.#.###.#.#######.#######.#
                #P...P#.#P#.......#P#..P....#...#.#.#....P#P#P..#.....#P.P#...#.#...#.#...#P..#.#.#...#.P...#...#.#...#...#P....#.....#.....#.#P..#P....#P..#P#..P#P#....P#.#.#.....#.#..P..#...#..P..#.......#P#...PP..#
                #.#####P#.#########.#.#####.#.###.#.#####.#.#####.#.#####.###.#.###.###.#.###.#.#.###.###.#######.###.#.###.#.###.#####.###.#####.#####.###.#.#.###.#.#.#.#.#P#####.#.#######.#######.#######.#.#.#######
                #....P#.#...#.......#.#P.P..#.#P..#P.P.P#.#...#P..#P#...#....P#...#.....#P.P#P.P#.#P#...#P#...#...#...#..P..#P..#P#PP.....#P#....P#...#...#.#P#.#P..#P#.#.#.#.#..P..#....P#P..#...#..P#P......#.#.#P...P#
                #####.#.###.#.#######.#.#####.#.#######.#.###.#.#####.#.#########.#########.#####.#.###.#.###.#.###.###.#######.#.#######.#.#.#####.#.###.#.###.#.#####.#.#.#P#.#####.###.###.#.#.#.###.#######.###.###.#
                #..P..#...#.#P.....P#.#....P.P#..P......#...#P..#P.P..#.....#P.P.P#...P..P#P.P..#.#...#.#...#....P#.#P......#..P#.#...PP..#.#...#...#...#.#..P..#..P#P..#...#.#.....#.#P#..P..#P#.#.#.#P.P..#P........#.#
                #.#######.#.#######.#.#################.###.###.#.###.#####.#.#####.#####.#####.#.###.#.###.#.#####.#########.###.#.#######.###.#.#.###.#.#########.#.#######.###.###.#.#######.###.#.#####.#.#########.#
                #.#...#P.P#.....#...#.........#.....#P#.#...#.#P#P..#P#P..#...#P.......P#.....#P#.....#...#P#P#...#.#P......#.#...#...#.#...#...#P#.#.#...#P....#...#P..#.....#..P#...#...#...#.....#..P#...#.....#.#...#
                #.#.#.#.###.#.###.#####.#####.#.#.#.#.#.#.###.#.###.###.#.#################.###.#####.###.#.###.#.#.#.#####.#.#.###.#.#.#.###.#####.#.###.#.###.#.#####.#.#####.###.###.###.#.#.#######.#.#######.#.#.###
                #...#...#P..#P.P#.....#P....#...#.#..P#.#.#.....#.#P#P..#...#P...P..P..PP...#...#.P...#...#.....#.#P..#P....#.#.#..P#.#...#...#.....#.....#..P#...#..P..#........P#.#P#.....#.#.#....P#.#.#...#....P#P..#
                #.#######.#####.#####.#####.#####.#####.#.#####.#P#.#.#####.#.#.###########P#.#########.#########.#####.#####.#.#.###P#.###.###.#####.#######.#####.###.###########.#P#.#####.#.#.#.#.#.#.###.#.#######.#
                #...#..P#..P#P#.....#.....#...#P#P.PP...#.#...#P#P#P..#.....#.#..P...P..#.#P#.#P........#...P..P#.#..P..#P#....P#...#P#..P..#....P.P#.#..P#P.P#P....#P....#.......#.#.#.#...#...#.#.#...#...#.#.#...#...#
                ###.#.#.###.#.#####.#####.###.#.#########.#.#.#.#.#####.#####.#########.#.#.#.###.#######.#####.#.#.#####.#.#######.#P#######.#####.#.#.###.#####.#########.#####.#.#P#.###.#####.#.###.###.#P#.#.#.#.#.#
                #...#P#P#...#...#...#P.P#...#P#.#P........#.#P#.....#.#P#P....#P#....P..#...#.#...#.#P.P....#P..#...#.....#.#.......#.#....P#.#P.P#.#...#...#..P#.#...#...#..P#.#P#P#P#......P.P#P#...#.#...#P#.#P#.P.#.#
                #.###.###.###.###.#.#.#####.#.#.#.#########.#.#####.#.#.#####.#.#.#######.###.#.###.#.#####.#########.#.###.#.#######.###.#.#.#.###.###.#.###.#.#.#.#.#.#.###.#.#.#.#.###.#####.#####.#.#.###.#P#.#####P#
                #P..#.........#P..#P#....P#.#...#P#P..#.#...#P.PPP#P..#.....#...#.#.....#...#..P#P..#...#...#.........#.#...#..P#P...P#...#P#.#...#P#.#P#.#...#.#...#..P#.#...#....P#....P#...#.......#.#P#...#.#P#P.P#.#
                ###.#.#########.###.#.#.###.#####.#.#.#.#.#.#####.#######.#.###.#.#####.###.#######.###.#.#.#.#######.#.#.#######.#####.#####.###.#P#.#.#.###.#.###.#####.#.###.###########.#.###########.#.#.#.#.###.#.#
                #P..#..P#...P...#P#.#P#.#...#P....#.#.#P..#.#..P#.#.P...#P#.#.#.#....P#...........#.#..P#P#P#.#....P#P#.#....P....#P#.....P...#P..#.#P..#.#P..#...#...#..P#.#P#.#P.P.P#.....#P.P.....P#...#P#P..#...#...#
                #.#######.#######.#.###.#.#.#.#####.#.#####.#.###.#.###.###.#.#.#####.#.#########.#.#.###.###.#.#.###P#.###########.#.#########.#.#P#####.#.#####.#####.###.#.#.#.###.#.#############.#.###########.#.###
                #...#....P#P......#..P#.#P#.#.#P....#P....#.#..P#.#.#P#.#..P#.#P#P..#.#.#P..PP.P#P..#.#P#.#..P#P#...#.#.#P.P....P.#...#P......#P#P#.#.....#P#...#.......#..P#P..#...#.#P#P......#...#.#....P...P....#.#.#
                ###.#.#####.###.#####.#.#.###.###.#######.#.#.#.#.#.#.#.#.###.#.###.#.###.#####.#####.#.#.#.#######.#.###.###.#####.#######.#.#.#.#.#.#####.#.#########.#.#########P#.#.###.###.#.#.#.###############.#.#
                #....P#P......#...P....P#.........#..P.....P#.#.....#.....#P........#..P......#....P....#P..........#P......#.........P.P...#...#.#P........#.......P...#....P......#P.....P#P....#.#...P.P..............
                #########################################################################################################################################################################################################
            """.trimIndent().split("\n").map { it.toList() }

            val palms = mutableListOf<Node<Char>>()
            val graph = buildGraph(input, { x, y, c -> Node(x, y, c) }, { it != '#' }, mapOf('P' to { _, n -> palms.add(n) }))
            val starts = graph.filterKeys { it.first == 0 || it.second == 0 ||
                    it.first == input.size - 1 || it.second == input[0].size - 1}.values.toList()
            val routes = buildRouteTable(starts)

            println(palms.maxOf { starts.minOf { start -> routes[start]!![it]!! } })
        }

        fun part3() {
            val input = """
                ###########################################################################################################################################################################################################################################################
                #.......#..P..#.......#...#.............#.........#.............P...........#.....#.............#...#.................#.......#...#.......#.....#.....#......P..P....P..#.#P........#...#.....#.....#.......#.........#.....#.......#.........#...........#
                #.#.###.#.###.###.###.#.#.#.#.#########.#.#######.#.###.###########.#######.#.#.###.###.#######.#.#.#.#.#############.###.#####.#.#.#####.#.###.#.#.###.#####.#########.#.#.#####.#.###.#.###.#.###.#.#.#####.###.#####.#.###.###.#.#.###.#.###.#########.#
                #...#.#.#P..#.....#...#.#...#.......#...#.#...#...#...#...#.......#.#.....#.#.#.......#...#P..#...#.#.#.#...#.....#.#.#...#.....#.#...#P#...#.#...#...#...#...#.......#.#.#.#.....#...#...#..P#.#.#...#.......#.#......P#.#...#P..#.#.#...#.#...#...#.....#
                #####.#.###.#########.#.###########.###.#.#.#.#.#####.###.#.#####.#.#.###.#.#.#######.###.###.#####.###.#.#.#.###.#.#.#.###.#####.###.#.#####.#######.#.###.#######.#.#.#.#.#.#######.#####.###.#.#########.###.#########.#.###.#####.#.#.###.###.###.###.#
                #.....#..P#.........#.#...........#...#...#.#.#.#...#P..#.#.#...#.#.#.#.#.#P#...#...#..P#...#.....#...#...#.#.#.....#...#...#...#...#..............P#...#...#.......#.#.#...#.#.....#.....#...#.#.....#...#...#.......#...#.#...#.....#.#.#...#.....#.#...#
                #.###.###.#####.###.#.###############.#####.###.#.#.#####.#.#.#.#.#.#.#.#.#.###.#.#.#######.#####.###.#####.#.#########.#.###.#.###.###########.#######.#.#####.#######.#.###.#.#########.###.#.#####.#.#.###.###.###.#.###.#.#.#.#####.#.#.#######.#.#.###
                #.#.#...#.....#...#.#..P..............#...#P#...#.#.#...#P#.#.#.#.#.#...#.#...#.#.#.......#...#.....#.......#...........#.#...#.#.#...........#.#.....#.#.....#.........#...#.#...#....P#...#.#...#...#.#.#.#...#...#.#.....#.#.#.....#.#.#.........#.#.#.#
                #.#.###.#####.#####.###################.#.#.#.###.#.#.#.#.#.#.#.#.#.###.#.###.###.#######.#.#.#.###.#########.#######.###.#.###.#.###########.#.#.###.#######.###.#########.#.###.#.###.###.#.###.#.#.#.#.#.###.#.#.#########.#.###.###.###########.#.#.#.#
                #.#.......#.#.......#...#.........#...#.#...#...#.#...#.#...#.#...#...#.#.#...#...#.#.....#.#.#...#.#.......#.#.....#...#...#...#.#.....#.....#.#.#.....#..P#...#...#...#...#...#.....#.....#...#...#.#.#.#.#...#.#.........#.#.#...#...#.....#..P..#.#.#.#
                #.#######.#.#########.#.#.#####.#.#.#.#.###.###.#.#####.#####.#########.#.###.#.###.#.#####.#.###.###.#.#####.#.###.#.#######.###.#.###.#.###.#.#.#####.#.#.#.#.###.#.#.#.#####.#########.###.#####.###.#.#.#.###.#####.###.#.#.#.###.###.#.#.#.#####.#.#.#
                #.#.....#...#.......#P#.....#...#...#.#.#.....#...#...#.#...#...#.......#...#...#.....#.....#.#...#...#...#...#.#P#.#.#.......#...#.#.#.#.#...#.#.....#.#.#.#.#P..#...#.#.#.#...#.......#...#.......#...#.#...#...#.....#...#.#.#...#...#.#.#.#...#...#.#.#
                #.#.###.###.###.###.#######.#.#######.#.###########.###.#.#.###.#.#########.#####.#########.#.#.###.#####.#.###.#.#.###.#######.###.#.#.#.#####.#####.#.#.#.#####.#####.#.#.#.###.#####.###.###.#####.###.###.###.#.#####.###.#####.###.#.#.#####.#.###.#.#
                #.#...#...#.....#.#.......#.#.#.........#.......#.....#...#...#...#.....#...#...#.#.......#.#.#.....#.....#P..#...#.#...#...#.........#.#.#.........#.#...#.......#.#...#...#...#.#...#...#...#...#...#P#...#...#P#.#...#.#.#.....#.#.#P..#.....#.#.#.....#
                #.###.###.#######.#######.#.#.#.#########.###.###.###.#######.#.#######.#.###.#.#.#.#.###.#.#.#.#####.#.#####.###.#.#.###.#.#.#####.###.#.#.#########.#############.#.###.#####.#.#.#####.###.###.#.###.###.###.###.#.#.#.#.###.#.#.#.#######.###.#.#######
                #.#...#...#.....#.....#...#.#.#...#.......#...#...#.......#.#.#.......#P#...#.#.#.#.#.#P#.#.#.#...#...#.#.....#.#.#...#P#.#...#...#.#...#.#.#...#...#.#..P#.....#.....#...#...#.#.#.....#.#...#...#.#.........#.....#.#.#...#...#.#...#.....#.#...#.......#
                #.#.###.#.#.###.#.###.#.###.#.#####.#######.#.#.###.#####.#.#.#.#####.#.###.#.###.#.#.#.#.###.#####.###.#.#####.#.#####.#.#####.#.#.#.###.#.#.###.#.#.#.###.#.###.#####.###.#.#.#.#.###.#.#.#####.#.#.#######.#########.###.#.#######P#.###.#.#.#########.#
                #...#...#.#.#.#.#.#.#...#P..#.....#.......#.#.#.#.#.....#...#.#.#...#...#...#.#...#.#.#.......#...#...#.#.#P....#...#...#.#.....#.#.#.#...#.#.#...#...#..P#.#.#...#...#...#.#...#.#...#.#.#.....#.#.#.#.....#.#.......#.#...#...#.....#...#.#...#.......#.#
                #.###.###.#.#.#.#.#.#############.#######.#.#.#.#.#####.#####.#.#.#.###.#.###.#.#####.#######.#.#.#.#.#.#.###.#####.#.###.#.#####.#.#.#.###.#.#.#########.#.#.#.#####.#.###.#####.#####.#.#####.###.#.#.###.#.#####.#.#.#.#####.#.#########.#######.#.###.#
                #.#...#...#...#.#.#.........#.....#.....#.#.#.#.#.#...#.......#.#.#...#.#.#...#.#.....#.....#.#P#.#.#.#.#...#.....#.#.....#.#..P#.#.#.#...#.#.#...#.......#P#...#.....#.#...#...........#.....#.....#P#.#...#...#..P#...#P..#.#.#.....#P....#.......#.#...#
                #.#.###.#####.#.#.#####.###.#.#####.#.###.#.###.#.#.#.#########.#.###.#.#.###.#.#.#####.###.###.#.#.#.#####.#####.#.#######.#.###.###.###.#.#.###.###.#####.#####.#.###.#.###.#########.#####.###.#####.#.#####.#.#########.#.#.#####.#.###.#.###.###P#.###
                #.#.#...#.....#.#.....#.#.....#.....#.#...#.#...#.#.#.........#.#.#...#.#...#...#...#...#...#P..#.#.#..P..#.#.....#.#.....#.#...#.......#...#...#...#P#...#...#...#.....#.......#...#...#...#.#...#.....#.#.#...#.............#.....#.#.#...#P..#...#.#...#
                #.#P#.###.#####.#####.#.#######.#####.#.###.#.###.#.#.#####.###.#.#.#######.#.#####.#.###.###.###.#####.###.#.#####.#.###.#.###.#######.#####.#.###.#.#.#.###.#.#################.#.#.###.#.#.#####.#####.#P#.#####.###########.#####.#.#.#######.#.#.###.#
                #.#.#...#...#...#..P....#.......#...#...#P#...#...#.#.#...#.#...#.#...#.....#.....#.#...#.......#.....#......P#.....#...#.#...#.#...#...#.....#...#.#...#...#.#.#...............#.#P#.....#.#.........#...#.#.....#.#.#.........#.....#.#.#P....#.#.#...#.#
                ###.###.###.#.###########.#######.#######.#####.###P#.#.#.###.###.###.#.#.#######.#.###.#############.#.#######.#######.#.###.#.#.#.#.#######.#####.#.#####.#.###.#############.#.#.###########.#####.#.###.#####.#.#.#.###.#####.#####.#.#.###.###.#.###.#
                #...#...#...#.............#.#...........#...#.......#...#...#.#.#.#.....#.#...#...#.....#.......#.....#P..#...#.........#.....#...#.........#P....#.#.#.....#.#...#...........#...#...........#.#...#.#.#.......#.#...#...#.#...........#.#...#.....#.#...#
                #.#######.#################.#.#######.#.#.#.#.#############.#.#.#.#########.#.#.#########.#####.#.#########.#.#################.###########.#####.#.###.#####.#.#########.#.#################.#.#.#.###.#.#.#####.#######.###.###########.###.#######.#.#.#
                #.......#.#...#.....#.......#.#.....#.#.#.#.........#.....#.....#...#.......#.#.#.........#.#.....#.........#....P........#.....#.#...#.....#.....#.#...#.....#.....#...#.#.......#...#...#...#.#.#...#.#.#...#...#.....#...#...#.....#...P...#.......#.#.#
                #.#####.#.#.#.###.#.#.#####.#.###.#.#.#.#.###########.###.#########.#.#######.#.###.#######.#.#####.#################.###.#.#####.#.#.#####.#.#.###.#.###.#####.###.#.#.###.#.###.#.#.#.#.#.#####.###.#.#.###.#.###.###.###.###.#.###.#########.#######.#.#
                #...#...#...#...#.#.#...#.#P..#...#.#.#.#.#.#.....#...#.#.........#.#.......#.#.#...#...#.....#.....#.......#.#.......#...#.#.....#.#.....#...#.#...#...#...#...#...#.#..P#.#...#...#...#.#.......#.#.#.#.#...#.....#...#...#...#.#...#...#...#.......#.#.#
                #####.#.#######.###.###.#.#####.#.###.#.#.#.#.###.#.###.#########.#.#######.#.#.#.###.#.#######.#########.#.#.#.#######.###.#.#.###.#####.#####.#.#####.###.###.#.#.#.###.#.###.#########.#########.#.#.#.#.#.#######.###.#.#.###.###.#.#.#.###.#######.#.#
                #.....#.#.....#.#...#...#......P#.#...#.#...#...#.#.#.......#...#.#.......#.#.#.#.#...#.....P.#.....#.....#...#.....#.....#.#.#.#...#...#...#...#...#.....#...#P#.#.#...#.#...#...#....P....#.......#...#.#.#P#.....#.#...#.#...#...#.#.#.#.....#.......#.#
                #.#####.#.#####.#.#.#.#####.#####.#.###.###.###.#.#.#.#.###.#.###.#.#####.#.#.#.#.#.#########.#####.#.#.#####.#####.#####.#.#.#.#.#####.###.#.#####.#.#######.###.###.###.###.###.#.#########.#####.#####.#.###.#.#.#.#.#.#.###.###.#.#.#.#.#####.#########
                #...#.#...#.....#.#.#.....#...#...#.#...#....P#.#.#P#.#.#...#.P.#.#...#.#...#.#P..#.#.......#.....#.#.#.#...#.....#...#...#.#.#.#.....#...#.#.....#.#.......#...#.....#...#...#...#.#.......#.#...#.#...#.#.....#.#.#.#.#.#...#...#.#...#.#.....#.....#...#
                #.#.#.###.#.#####.#.#####.###.#####.###.#######.#.#.###.###.###.#.###.#.#####.###.#.#####.#.#.#####.#.#.#.#.###.#####.#.###.###.#####.#.###.#######.#.#####.###.#####.#.#####.#.###.#.#####.#.#.#.#.#.#.#.#######.###.#.#.#######.#.#####P#######.###.#.#.#
                #.#.#.....#...#...#.#...#.....#...#...#.......#.#.#...#...#.....#.#.#...#...#.#...#.......#.#...#...#.#.#.#...#.#.....#.#...#...#...#.#..P..#...#...#...#.#...#.....#.#P....#.#.#.#.#P.P#...#.#.#.#...#.#.#.....#...#.#.#...#...#.#.#......P...P#...#...#.#
                #.#.###.#####.#.#.#.###.#####.#.#.###.#######.#.#.###.###.#####.#.#.###.#.#.#.###.#########.###.#.###.###.###.#.#.#######.###.#.#.#.#.###.###.#.#.#####.#.###.#####.#.#####.###.#.#.###.#.###.#.#.#####.#.#.#######.#.#.###.#.#.#.#.#.#########.###.#####.#
                #.#...#.#.#...#.#.#.....#.....#.#.#...#.....#...#.#...#...#.....#.#.......#.#...#...#..P#...#...#.#.......#.#.#.#.........#...#.#.#.#...#.....#...#.#...#...#.......#.#.....#...#.#...#.#...#.#.#.....#...#.....#...#.#.#P#...#.#.#.#...#...#P#.#.#.#.#...#
                #.###.#.#.#.###.#.#####.#.#####.#.#.###.###.#####.#.###.###.#####P#######.#####.###.###.#.###.###.#.#######.#.#.###########.###.#.#.###.###########.#.###.#############.#####.###.###.#.###.#.#.###.#.#####.###.#.###.#.#.#####.#.#.#####.#.#.#.#.#.#.#.#.#
                #...#.#...#.#...#...#...#.#.....#.#.#.#.#.#.....#.#...#.#...#...#.....#...#.....#.#.....#.#.#.....#.........#.#.#...#..P....#.....#...#P#.......#.....#.............#...#.....#.......#.#.#...#.#.#.#P....#...#.#.....#P..#.....#.#.......#.#.#.#.....#.#.#
                ###.#.###.#.#.#####.#####.#.#####.#.#.#.#.#.#####.###.#.###.#.#.#####.#.###.#####.#####.#.#.#######.#########.#.#.#.#######.###########.#####.#.#.#######.###.#####.#.###.#########.###.#.#####.#.#.#########.#.#########.#.###.#.#########.#.#.#####.#.#.#
                #.#.#...#.#.#.#...#.......#...#.#.#.#.#...#.#...#.#...#...#P#.#...P...#...#.#.#.....#...#.#...#.....#.........#...#.......#.....#.......#...#.#.#...#...#P#...#...#...#.#.........#.#...#.....#...#...#.......#.........#.#.#...#.#.#.......#.#...#...#.#.#
                #.#.###.#.#.#.###.#####.#####.#.#.#.#.###.#.#.#.#.#.#####.###.#########.###.#.#.#.###.###.#.#.###.###.###################.#####.#.#######.#.###.###.#.#.###.###.#.#####.#.#######.#.#.#######.###.###.#.###########.#####.#.#####.#.#.#######.###.#.###.###
                #...#.#.#.#.#.....#...#.#.....#...#.#.#...#...#...#.#.....#...#.......#.#...#...#.#...#.#.#.#...#...#P........#.............#...#.#.......#...#...#...#.#...#...#.#.......#...#...#.#.#.....#.......#.....#.....#...#.....#.#..P..#.#.....#.....#.#...#...#
                #.###.#.#.#.#####.#.#.#.#.#####.###.#.#.###########.#.###.#.###.#.#####.#.#####.#.#.###.#.#.###.###.#########.#.###########.#.#.#.###.#.#####.#.#######.#.###.###P#.#######.#.#.#####.###.#.###############.###.#.###.#####.#.#####.#####.#.###.#.#.#####.#
                #.....#.#.#.....#.#.#.#.#...#.#.....#.#.............#.#...#.#...#.......#.....#.#.#.#...#...#.#.#.........#...#...#.....#.#...#.#...#.#...#...#.......#.#...#...#.#.........#.#.....#.....#...#...#.........#...#.....#...#...#...#.....#.#...#...#.#...#.#
                #####.#.#.#####.###.#.#####.#.#######.###############.#.###.#####.###########.#.#.#.###.#####.#.#.#########.#.#####.###.#.#####.###.#.###.###.###.###.#.###.###.#############.#####.#########.#.#.#.#########.#####.###.#######.#.#.###.#.#######P###.#.#.#
                #.....#.#.#.....#...#...#...#.......#.....#.#.........#..P#.....#...#...#...#.#.#.#.......#.....#.#.#.....#.#.#...#.#.#.#.#.......#.#...#...#.....#P..#.....#...#...#.......#.#...#.....#...#.#.#.#.#.#.....#.....#...#.....#...#...#...#.......#...#.#...#
                #.#####.#.#.#####.#####.#.###.#####.#.#.#.#.#.#######.#########.#####.#.#.#.#.###.#######.#.#####.#.#.###.#.#.#.#.#.#.#.#.#.#######.#####.#.#################.###.#.#.#####.#.#.#.#####.#.#.#.#.#.#.#.#.###.#####.###.###.#.#.#######.#########.###.#.#####
                #.#.....#.#.#.....#.#...#...#.#...#.#.#P#...#P..#...#.#.........#.....#...#...#...#.....#.#...#P....#.#..P#.#P#.#...#...#...#.....#.....#.#...#.........#.........#.#.#...#...#.#.....#.#.#.#P#.#...#.#.#.......#.#.......#...#.....#.#.......#.#.#.#.....#
                #.#.#######.#.#####.#.#####.#.#.#.#.###.###.###.#.###.#.#########.#############.###.###.#.###.#######.#.###.#.#.#####.#######.###.#####.#####.#.#######.#.#########.#.###.#######.###.#.#.#.#.#.#####.#.#.###.###.#############.###.#.#.#.###.#.#.#.#####.#
                #.#.......#...#.....#.......#.#.#.......#.....#.#.#...#.#.....#.....#.......#.......#...#.#.........#.#.....#.#.#...#.........#.#.#...#P..#...#.#.....#.#...#...#...#.............#P#.#...#.#.#...#.....#...#.#...#.........#.....#...#.#.#...#.#.........#
                #.#######.#####.#############.#################.#.#.###.#.###.#####.#.#####.#.#######.###.#.#######.#.#######.#.#.#############.#.#.#.###.#.###.###.###.###.#.###.#################.#.#####.#.###.#####.###.###.###.#######.#.#####.#####.#.###.#########.#
                #.......#.....#.#...#...#............P#...#...#.#.#.....#.#.....#...#.#...#...#.....#.....#.#...#.....#...#...#.#.#...........#.#...#.....#.........#.....#...#...#.......#P....#.....#...#...#...#...#...#P..#.....#.......#.#...#.......#...#.....#.#...#
                #######.###.#.#.#.#.#.#.#.###########.#.#.#.#.#.#.#######.#####.#.###.#.#.#.###.###.#######.#.#.#########.#.###.#.#.#.#######.#.###################.#.###.###.#.###.###.###.#.###.#####.#######.###.#.###.###.#######.#######.#.#.#########.#######.#.#.###
                #....P#P#.#.#.#...#...#.#...........#...#...#.#.#....P#.....#...#.#...#.#.#.#...#.#.........#.#.........#...#...#.#.#.#.......#.....#.........#.#...#.#.....#.#.....#...#...#...#.#...#.......#..P..#.#.#.#.#.......#.....#...#.#.........#.#.....#.#.....#
                ###.#.#.#.#.#.#####.###.###########.#########.#.#.#####.###.###.#.#####.#.###.###.#######.###.#########.#####.###.#.#.#######.###.#.###.#.###.#.#.###.#.#####.#######.###.#####.#.#.#.###.###.#.#####.#.#.#.#######.#####.#.###.#########.###.###.#.#####.#
                #...#.#...#.#.#...#P#...#.......#.#.#.P...#...#.#.#...#...#...#...#P....#...#.#.....#...#...#.#...#.....#.....#.....#...#...#.....#...#.#.#.#.#.....#.#...#P..#.....#.....#.....#...#...#.#...#.....#.#.#.#.....#.....#...#...#.#.....#....P..#...#...#...#
                #.#.#####.#.#.#.#.###.#.###.###.#.#.#####.#.###.#.#.#.###.###.#####.#######.#.#.###.#.#.#####.#.###.#####.#######.#####.#.#.#########.###.#.#.#####.#.#####.#####.#########.###.#######.#.###.#####.#P#.#.#####.#.#####.#####.#.#.###.#########.#####.#.###
                #.#.#.....#.#...#.#...#.....#.#.#.#.....#.#.....#.#.#.#.....#.#.....#.....#...#...#.#.#.......#.....#.....#.....#.#...#...#.#.......#.....#.#.#...#.#.....#.....#.......#...#.#.#...#...#...#...#.#.#.#.....#...#.......#.....#.....#...P.#...#.#.....#.#.#
                #.###.#####.#####.#.#########.#.#.#####.#.#######.#.#.#.#####.#.#####.###########.###.#########.#####.#.###.###.#.#.#.#####.###.#.#########.#.#.#.#######.#####.#######.#.###.#.#.#.#.#####.###.#.#.#.#####.#.#.###############.#####.###.#.###.#.#.###.#.#
                #.#...#.....#...#...#P#.....#...#.#...#.#...#.......#.#.#P#..P#.....#..P....#.....#...#.......#.....#.#.#...#...#.#.#P#...#...#P#.#.........#...#...#.......#...#...#...#...#.#.#.#.#.......#P#.#...#.#...#...#...#...........#.#...#...#.#.#...#.#.#P#...#
                #.#.###.#######.#####.#.###.#.###.#.#.#.###.#.#######.#.#.#.#######.#.###.###.#.#.#.#######.#.#####.#.###.###.###.#P#.###.###.#.###.#.#############.#.#####.#.###.#.#.#####.#.#.#.#.#########.#.#.###.#.#.#######P#.#####.###.###.#.#####.#.#.#####.#.###.#
                #...#...#.....#.#.........#.#...#...#.#.#...#.#...#...#...#.....#...#...#.....#.#.#.......#.#.......#.#...#...#...#.#.......#.#.....#.................#.....#.#...#.#.#.....#.#...#.#.........#.#.#...#.#.#.....#.#.#.....#.#.....#.....#.#...#.....#...#.#
                #####.###.#.#.#.#.#########.###.#.###.#.#.###.###.#.#####.#####.#.#####.#######.#.#######.###.#######.#.###.###.###.#######.#.#########.###########.#######.#.#.###.#.#.#####.#####.#######.#.#.#.#.###.#.#####.#.###.#####.###########.#.#.#####.#####.#.#
                #.....#.#.#.#...#.#.......#...#.#.#...#.#.......#.#.....#...#...#...#........P#.#.#.#...#...#.#.......#.#.#.#.#.#.....#...#.#.....#...#.#.........#.#.....#.#.#...#.#.#.#P..................#.#.#.#.....#.....#.#.....#...#...............#.#...#.....#.#.#
                #.#####.#.#P#####.#.#####.###.#.#P#.###.#.#####.#.#####.###.#.#####.###########.#.#.#.#.###.#.#.#######.#.#.#.#.###.#.#.#.#.#####.#.#.###.#######.###.###.###.#.#.#.#.#.#####.###########.#####.#.###########.#.#######.###.###############.#.#.#.###.#.#.#
                #.#...#...#.......#.....#...#...#.#.#...#.#...#.....#.#...#.#......P#.......#...#.#...#P#...#.#.#.......#.#.#.#...#.#...#.#.....#.#.#.....#.....#...#...#.....#.#.#.#.#.....#.#...#...#...#.....#.#.#...#.....#...#..P....#...#...#...#...#...#.#.#...#.#.#
                #.#.###.###############.###.###.#.#.#.#####.#.#####.#.###.#.#########.#####.#.###.#####.#.###.#.#.#######.#.#.###.#.#####.#######.#.#######.#####.#.###.#########.#.#.#####.###.#.#.###.###.#####P#.#.#.#.#####.###.#####.#.###.#.#.#.###.#####.###.###.#.#
                #.#.....#.......#.....#...#...#.#P#.#.#.....#.#...#.#...#.#.#.........#...#.#...#P......#.#...#.#.....#...#.#.#...#.#...#.......#...#.......#...#.#...#...#...#...#P#.....#.#...#.#.#.....#.#.....#.#.#...#.......#.#...#...#...#...#.#.....#...#...#...#.#
                #.#.#####.#.#.###.#.###.#####.#.###.#.###.###.#.#.#.#.#.#.#.#.#########.###.###.#########.#.###.#####.#.###.#.#.###.#.#########.#########.#.#.#.#####.###.#.#.#.###.#.#.###.#.###.#.#.#####.#.#####.#.#####.#####.#.#.#.#####.#######.#.#####.###.###.#.#.#
                #.#.#.....#.#.#...#.....#.....#..P#.#P....#.#.#.#...#.#.#...#.....#...........#...#.......#.....#...#.#.#...#...#.#.#.....#.....#.......#.#.#.#.........#.#.#.#...#.#P#...#...#...#.#...#...#.......#..P#P......#.#...#.#...#.#...#..P#.......#...#...#.#.#
                #.#.#.#####.#.#.#########.#######.#.#######.#.#.#######.#########.###########.###P#.#####.#####.#.#.#.#.#.#####.#.#.#.###.#.###.#.#####.#.###.#########.#.#.#.###.#.#####.#####.###.#.###.#########.###.#######.#.#####.###.#.#.#.#.###.#######.###.###.#.#
                #.#.#.#.....#.#...#...#.#...#...............#.#.....#.....#.......#.........#...#.#...#.#.#...#.#.#...#.#.....#.#...#...#.#.#...#P#.....#...#.......#...#...#..P..#...........#.#...#.#...#.......#...#.#...#...#.....#..P#.#.#.#.#.#.#....P....#...#...#.#
                #.#.#.#.#####.###.#.#.#.###.###############.#.#####.#.###.###.#####.#######.###.#.###.#.#.#.#.###.#####.#####.#.###.#####P#.#.###.#.#######.#######.#########.#########.#######.#.#.#.#.#########.###.#.#.#.#########.###.#.#.#.###.#.###############.#.#.#
                #.#.#.#.#...#...#...#.#...#.#...#.....#...#.#...#...#.#.#...#.#...#.#.#.....#.#.#.#...#...#.#.....#...#.....#.#...#.......#.#.#...#.#...#...#.....#.....#.....#.......#.#...#...#.#...#.#...#...#....P#...#.........#...#.#.#.#.#...#.............#...#.#.#
                #.#.###.###.#.#######.#.#.#.#.#.#.###.###.#.###.#.###.#.###.#.#.#.#.#.#.#####.#.#.#.#######.#######.#.#.#####.###.#####.###.#.#.###.#.#.#.#.#.###.#####.#.#####.#####.###.#.#.#########.#.#.#.#.###.#####.#########.#.###.#.#.#.#.###.###########.#.#####.#
                #.#.....#...#.#.....#.#.#.#...#...#.#...#...#.#.#.....#...#.#...#.....#.....#...#.#......P..#.#.....#...#.....#P#...#...#...#...#.....#.#.#.#.#...#...#...#.....#.....#...#.#...#.....#...#...#...#.#...#.....#.....#.#.....#...#.#....P#.......#...#.....#
                #.#######.###.#.###.#.###.#########.###.###.#.#.#########.#.###.###########.#.###.#########.#.#.###.#####.#####.###.#####.#####.#######.#.#.###.#.#.#######.#####.#####.###.###.#.###.###########.#.#.#.#####.#.#####.#.#######.#.#.###.#.#.###.###.#P#####
                #.....#...#...#.#.#.#...............#P#...#.#.#.#.........#...#.#.....#.....#.#...#.......#.#...#.#.....#.#...#...#.......#.....#...#.....#..P..#...#.......#..........P#.......#.#.#.......#.....#.#.#.#...#.#.#.........#...#.#.#.#...#.#...#.#...#.#...#
                #.###.#.###.###.#.#.###############.#.###.#.#.#.#####.#.#####.###.###.#.#####.#.#.#.#####.#.###.#.#####.#.#.#.#.#.#.###########.#.#.#############.###.#######.#############.#####.#.###.###.#.#######.#.#.#.#.#.#########.#.#.#.#.#.#.#####.#.###.###.#.#.#
                #.#...#.......#.#.#.#........P.P..#...#...#...#.....#.#.#...#.#...#.....#.......#.#.#...#.#...#......P#.#...#.#.#...#.........#.#.#.......#.......#..P#.....#.....#.......#.#...#...#P#...#.#...#...#.#.#.#.#.#.....#...#.#.#...#.#.#.....#.#.#P..#..P#.#.#
                #.#.###.#######.#.#.#.#.#############.#.#####.#####.#.#.#.#.#.#.#########.#########.#.#.#.###.#.#######.#####.#####.#.#######.#.#.#######.#.#######.###.#####.#####.#####.###.#.###.#.###.#.###.#.#.#.#.#.#.#.#####.#.#.#.#.#####.#.#####.###.#.###.###.#.#
                #.#.#.....#.....#.#...#.......#.......#...#.......#.#.#...#.#.#.....#.......#.....#.#.#...#.#.#.#.........#.#.#...#.#.#.....#.#.#...#..P..#...#...#.#.........#...#.....#.....#.....#...#.#...#...#...#.#.#.....#.#...#.#.#...#...#.#...#...#...#...#...#.#
                #.#.#.#####.#####.###########.#.#########.###.#####.#.#####.#.#.###.#.#######.###.#.#.#####.#.###.#######.#.#.#.#.###.#.###.#.###.###.#######.#.###.###.#######.#.#####.#############.###.#.###########.#######.#.#####.#####.#.###.###.###.#.###.#####.#.#
                #.#.#.#....P#...............#...#.......#P..#.#.....#.#...#...#.#...#.....#...#.#.#.#.#.....#.#...#.........#...#.......#...#.....#...#..P....#...#...#.....#...#...#...........#.....#...#.#...#.......#.....#...#...#.#...#.#.#.#...#...#.#...#.#.....#.#
                #.#.###.#################.#.#####.#########.###.#####.###.#######.#.#####.#.###.#.#.#.#####.#.#.###.###########.#########.#########.#######.###.#.###.#####.#.#####.#.#########.#.#.###.#.###.#.#.#######.###.###.#.#.#.#.#.#.#.#.###.###.#.###.#.###.###.#
                #.#...#.............#.....#.....#.........#...#.#..........P#...#.#P#...#.#.#.#...#.#.#...#.....#P#.....#.....#.#...#.....#.....#...#.....#...#.#...#.#.....#...#.#...#...#.......#.#...#.#.P.#.#.#.......#.#...#.#.#.#...#...#.#.#...#...#.#.#.#.....#...#
                #.###.#############.#.#########.#.#######.###.#.###########.#.#.#.#.#.#.#.#.#.#.###.#.#.#.#######.###.###.###.###.#.#.#####.###.#.###.###.###.#####.#.#########.#.#####.#.###########.###.#.###.#.#####.###.###.#.#.#.#######.#.#.#.###.###.#.#.#######.###
                #...#.....#.....#.#.#.#.....#.#.#.......#P#...#.......#.......#...#.#.#.#.#.#.#.#...#...#.......#.....#...#.#.#...#.#...#..P#.#.#.....#...#...#.....#.........#...#P#...#.....#...#...#...#.#...#.#..P#.#.....#.#.#.#.......#.#P#.#...#.#...#.#.#P....#.#.#
                ###.#.###.#.###.#.#.#.#.###.#.#.#####.###.#.#########.#############.#P#.###.#.#.#.#############.#####.#.###.#.#.###.#P###.###.#.#.#####.###.###.###.#########.###.#.#.#######.#.#.#.###.###.#.#.#.#.#.#.#####.#.###.#######.#.#.#.###.#.#.###.#.#.###.#.#.#
                #...#P#P#...#.....#.#.#.#.#.#.#...#...#...#.........#.......#..P#..P#.#.....#.#.#.#P..........#.....#.#.#......P#...#.#...#.....#.#...#.#.#.....#.#.......#...#.#.#.#.....#.#..P#...#.#.#.#.#P#.#...#.#.#.....#.....#.....#.#.#.#...#.#.#...#...#...#...#.#
                #.###.#.#####.#####.#.#.#.#.#.###.#.###.###########.#######.#.###.###.#######.#.#.#######.###.#####.#.#.###########.###.###.#####.#.###.#.#######.#######.#.#.#.#.#.#####.#.#########.#.#.#.#.#.#####.#.#.#############.#.#.###.#.#.#.#.###.#######.#####.#
                #...#.#.........#...#.#.#.#.#.....#.#P#.....#.....#.#.......#.......#...#.....#.#.#.....#..P#.....#.#P#...........#...#...#.#.#...#...#.#.........#...#...#.#...#.#.#.....#...............#.#.#.#...#...#.#.............#.#.....#.#...#...#.......#.#.....#
                #####.#.#########.###.#.#.#.#####.#.#.#####.#.###.#.#.###############.#.#####.#.#.#.###.#####.#####.#.###########.###.###.#.#.#.#####.#.#####.###.#.#.#.###.###.#.#.#.#####.#######.#######.#.###.#.#####.#.#######.#####.#######.#####.#.#######.#.###.#.#
                #...#.#.#.....#...#...#.#.#.....#.#...#.....#...#.#.#...............#.#.....#.#.#.....#.....#.#.....#...........#...#.#...#.#......P..#....P#.#...#.#...#...#...#.#.#...#.....#...#.#.....#.#.#...#.........#P....#.....#.......#.....#.#.#.......#.....#.#
                #.#.#.#.#.###.#.###.###.#.#####.#.#####.#######.#.#.###############.#.#####.#.#.###########.#.#.#########.#########.#.#.###.#.###########.#.###.###.#####.#######.#.###.#.#####.#.###.###.#.#.#.#################.#####.#############.#.###.#.###########.#
                #.#...#P#.#.#.#.#...........#...#.......#.......#...#........P#.....#P#...#.#.#...........#.#.#.........#.#.........#.#.#.#.#.#.........#P#.#...#...#...#.#.....#.#...#.#...#...#...#.#.#...#.#.#.................#.#...#...#...#.....#.#...#.#...#....P..#
                #.#######.#.#.#.#############.#########.#.###########.###.#####.#######.#.#.#.###########.#.#.#########.###.#########.#.#.#.###.#######.###.#.###.###.#.#.#.###.#.###.#.#####.#####.#.#.#####.#.###########.#####.#.#.###.#.#.#.#.#####.#.#####.#.#.#######
                #...........#.................#.........#...............#...............#...#...............#...............#...........#.......#..........P#.........#.#.....#.......#...........#.........#...............#.......#.....#...#.........#.......#.........#
                ###########################################################################################################################################################################################################################################################
            """.trimIndent().split("\n").map { it.toList() }

            val palms = mutableListOf<Node<Char>>()
            val starts = mutableListOf<Node<Char>>()
            val graph = buildGraph(input, { x, y, c -> Node(x, y, c) }, { it != '#' },
                mapOf('P' to { _, n -> palms.add(n) }, '.' to { _, n -> starts.add(n) }))

            val routes = buildRouteTable(palms)

            println(starts.minOf { start ->
                palms.sumOf { palm -> routes[palm]!![start]!! }
            })
        }
    }
}